<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ø°ÙƒØ±ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</title>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Tajawal&display=swap" as="style">
  <!-- Ø®Ø·ÙˆØ· Ø¥Ø¶Ø§ÙÙŠØ© -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&family=Dancing+Script:wght@700&family=Amiri:wght@400;700&family=Almarai:wght@300;400;700&family=Cairo:wght@300;400;600;700&family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@300;400;600;700&family=Lato:wght@300;400;700&family=Montserrat:wght@300;400;500;700&family=Poppins:wght@300;400;500;700&family=Fira+Sans:wght@300;400;500;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
  <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Base Reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Tajawal', Arial, sans-serif; line-height: 1.6; color: var(--text-color); background-color: var(--bg); overflow-x: hidden; transition: background-color 0.3s, color 0.3s; }

    /* Color Palette - Light Mode */
    :root {
      --primary: #8B4513;
      --primary-light: #D2B48C;
      --accent: #F5F5DC;
      --bg: #FFFFFF;
      --text-color: #333;
      --card-bg: #F5F5DC;
      --toolbar-bg: #FFFFFF;
      --editor-bg: #FFFFFF;
      --modal-bg: #FFFFFF;
      --menu-bg: #FFFFFF;
      --pinned-color: #FFD700;
      --success-color: #4CAF50;
      --error-color: #f44336;
      --checkbox-color: #8B4513;
      --clock-bg: #f0f0f0;
      --clock-text: #333;
      --game-bg: #f8f9fa;
    }

    /* Dark Mode */
    .dark-mode {
      --primary: #D2B48C;
      --primary-light: #8B4513;
      --accent: #2D2D2D;
      --bg: #121212;
      --text-color: #E0E0E0;
      --card-bg: #2D2D2D;
      --toolbar-bg: #1E1E1E;
      --editor-bg: #1E1E1E;
      --modal-bg: #2D2D2D;
      --menu-bg: #2D2D2D;
      --pinned-color: #FFC600;
      --success-color: #388E3C;
      --error-color: #D32F2F;
      --checkbox-color: #D2B48C;
      --clock-bg: #2a2a2a;
      --clock-text: #E0E0E0;
      --game-bg: #1a1a1a;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes scaleIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    @keyframes slideIn {
      from { transform: translateX(-50px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
      100% { transform: translateY(0px); }
    }

    /* Header & Nav */
    header { 
      background-color: var(--primary); 
      padding: 1rem 2rem; 
      color: #fff; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      animation: fadeIn 0.5s ease-out;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .logo { 
      font-size: 1.5rem; 
      font-weight: bold; 
      font-family: 'Dancing Script', cursive;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .logo-icon {
      font-size: 1.8rem;
    }
    nav ul { list-style: none; display: flex; gap: 1rem; }
    nav a { color: #fff; text-decoration: none; font-weight: 500; padding: 0.5rem 1rem; border-radius: 5px; transition: all 0.3s; }
    nav a:hover, nav a.active { background-color: rgba(255,255,255,0.2); text-decoration: none; }

    /* Play Button */
    .play-btn {
      background-color: rgba(255, 255, 255, 0.2);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.9rem;
      margin-left: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      border: 1px solid white;
    }

    .play-btn:hover {
      background-color: var(--accent);
      color: var(--primary);
      transform: scale(1.05);
    }

    /* Header Controls */
    .header-controls {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    /* Notebooks Counter */
    .notebooks-counter {
      background-color: rgba(255, 255, 255, 0.2);
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.9rem;
      margin-left: 1rem;
    }

    /* Language Switch */
    .lang-switch button { 
      background: transparent; 
      border: 1px solid #fff; 
      color: #fff; 
      padding: 0.3rem 0.6rem; 
      margin-left: 0.5rem; 
      cursor: pointer; 
      border-radius: 0.25rem; 
      transition: all 0.3s;
    }
    .lang-switch button:hover, .lang-switch button.active { 
      background-color: var(--accent); 
      color: var(--primary); 
    }

    /* Dark Mode Toggle */
    .dark-mode-toggle {
      background: transparent;
      border: 1px solid #fff;
      color: #fff;
      padding: 0.3rem 0.6rem;
      cursor: pointer;
      border-radius: 0.25rem;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .dark-mode-toggle:hover {
      background-color: var(--accent);
      color: var(--primary);
    }

    /* Clock Widget */
    .clock-widget {
      position: fixed;
      top: 10px;
      left: 10px;
      background-color: var(--clock-bg);
      color: var(--clock-text);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      font-family: 'Tajawal', sans-serif;
      font-size: 1rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s;
      animation: fadeIn 0.5s ease-out;
    }

    .clock-widget:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .clock-time {
      font-size: 1.2rem;
      font-weight: bold;
    }

    .clock-date {
      font-size: 0.8rem;
      margin-top: 0.2rem;
    }

    .clock-settings {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background-color: var(--modal-bg);
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      width: 200px;
      z-index: 1001;
    }

    .clock-widget.active .clock-settings {
      display: block;
      animation: fadeIn 0.3s ease-out;
    }

    .clock-settings label {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .clock-settings select {
      width: 100%;
      padding: 0.3rem;
      margin-bottom: 1rem;
      background-color: var(--bg);
      color: var(--text-color);
      border: 1px solid var(--accent);
      border-radius: 4px;
    }

    /* Main Title */
    .main-title {
      text-align: center;
      margin: 2rem 0;
      font-family: 'Dancing Script', cursive;
      font-size: 3.5rem;
      color: var(--primary);
      animation: slideIn 0.8s ease-out;
      position: relative;
    }

    .main-title::after {
      content: '';
      display: block;
      width: 100px;
      height: 3px;
      background: var(--primary);
      margin: 0.5rem auto;
      border-radius: 3px;
    }

    /* Notebooks Grid */
    .notebooks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .notebook-card {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      animation: fadeIn 0.5s ease-out;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      position: relative;
      border: 2px solid transparent;
      display: flex;
      flex-direction: column;
      min-height: 200px;
    }

    .notebook-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    .notebook-card.pinned {
      border-color: var(--pinned-color);
      box-shadow: 0 4px 8px rgba(255, 215, 0, 0.3);
    }

    .notebook-card.pinned::after {
      content: 'ğŸ“Œ';
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 1.2rem;
    }

    .notebook-actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: auto;
      padding-top: 1rem;
    }

    .notebook-btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      font-size: 0.9rem;
    }

    .add-btn {
      background-color: var(--primary);
      color: white;
    }

    .delete-btn {
      background-color: var(--error-color);
      color: white;
    }

    .pin-btn {
      background-color: var(--pinned-color);
      color: #333;
    }

    /* Notebook Rating */
    .notebook-rating {
      margin: 0.5rem 0;
      color: var(--pinned-color);
      font-size: 1.2rem;
    }

    .star {
      cursor: pointer;
      transition: all 0.2s;
    }

    .star:hover {
      transform: scale(1.2);
    }

    /* Add Notebook Button */
    .add-notebook-container {
      display: flex;
      justify-content: center;
      margin: 2rem 0;
    }

    .add-notebook-btn {
      background-color: var(--primary);
      color: white;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 5px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .add-notebook-btn:hover {
      background-color: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      animation: pulse 1s infinite;
    }

    /* Notebook Menu */
    .notebook-menu {
      position: absolute;
      top: 10px;
      left: 10px;
      cursor: pointer;
      font-size: 1.2rem;
      padding: 0.3rem;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      color: var(--text-color);
    }

    .notebook-menu:hover {
      background-color: rgba(0,0,0,0.1);
    }

    .menu-dropdown {
      position: absolute;
      top: 35px;
      left: 0;
      background: var(--menu-bg);
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 10;
      display: none;
      min-width: 120px;
    }

    .menu-dropdown.show {
      display: block;
      animation: fadeIn 0.2s ease-out;
    }

    .menu-dropdown button {
      width: 100%;
      text-align: right;
      padding: 0.5rem 1rem;
      border: none;
      background: none;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text-color);
    }

    .menu-dropdown button:hover {
      background-color: var(--accent);
    }

    /* Back Button */
    .back-btn {
      background-color: var(--primary);
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 1rem 0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .back-btn:hover {
      background-color: var(--primary-light);
      transform: translateY(-2px);
    }

    /* Auto-save Indicator */
    .auto-save-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--success-color);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      font-size: 0.9rem;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .auto-save-indicator.show {
      opacity: 1;
    }

    /* Rename Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: var(--modal-bg);
      padding: 2rem;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      animation: scaleIn 0.3s ease-out;
      color: var(--text-color);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .modal-title {
      margin-bottom: 1.5rem;
      color: var(--primary);
      text-align: center;
      font-size: 1.5rem;
    }

    .modal-input {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid var(--accent);
      border-radius: 5px;
      margin-bottom: 1.5rem;
      font-size: 1rem;
      background-color: var(--bg);
      color: var(--text-color);
      transition: border-color 0.3s;
    }

    .modal-input:focus {
      border-color: var(--primary);
      outline: none;
    }

    .modal-actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
    }

    .modal-btn {
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      min-width: 100px;
    }

    .modal-btn.confirm {
      background-color: var(--primary);
      color: white;
    }

    .modal-btn.confirm:hover {
      background-color: var(--primary-light);
    }

    .modal-btn.cancel {
      background-color: var(--accent);
      color: var(--text-color);
    }

    .modal-btn.cancel:hover {
      background-color: var(--text-color);
      color: var(--bg);
    }

    /* Editor Section */
    .editor-container {
      display: none;
      animation: scaleIn 0.5s ease-out;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    .editor { 
      margin: 2rem auto; 
      background: var(--accent); 
      padding: 1rem; 
      border-radius: 0.5rem; 
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .toolbar { 
      background: var(--toolbar-bg); 
      padding: 0.8rem; 
      border-bottom: 1px solid var(--accent); 
      display: flex; 
      gap: 0.8rem; 
      flex-wrap: wrap; 
      align-items: center; 
      border-radius: 0.5rem 0.5rem 0 0;
    }

    .toolbar button, 
    .toolbar select, 
    .toolbar input[type="color"] { 
      padding: 0.5rem 0.8rem; 
      border: none; 
      background: var(--primary-light); 
      cursor: pointer; 
      border-radius: 0.25rem; 
      font-size: 1rem; 
      color: var(--text-color); 
      transition: all 0.2s;
    }

    .toolbar button:hover, 
    .toolbar select:hover, 
    .toolbar input[type="color"]:hover { 
      background: var(--primary); 
      color: #fff; 
      transform: scale(1.05);
    }

    #editor-area { 
      min-height: 500px; 
      padding: 1.5rem; 
      background: var(--editor-bg); 
      border-radius: 0 0 0.5rem 0.5rem; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
      outline: none; 
      font-size: 1.1rem;
      line-height: 1.8;
      resize: both;
      overflow: auto;
      min-width: 300px;
      max-height: 80vh;
      color: var(--text-color);
    }

    /* Font Size Slider */
    .font-size-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .font-size-slider {
      width: 100px;
    }

    .font-size-value {
      min-width: 30px;
      text-align: center;
    }

    /* Footer */
    footer { 
      background: var(--primary); 
      color: #fff; 
      text-align: center; 
      padding: 1.5rem; 
      margin-top: 2rem; 
      animation: fadeIn 0.8s ease-out;
    }

    footer p { 
      font-size: 0.9rem; 
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--success-color);
      color: white;
      padding: 1rem 2rem;
      border-radius: 5px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .toast.show {
      opacity: 1;
    }

    .toast.error {
      background-color: var(--error-color);
    }

    /* Loading Spinner */
    .spinner {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .spinner-inner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Checkbox styles for tasks */
    .task-checkbox {
      display: inline-flex;
      align-items: center;
      cursor: pointer;
      margin: 0.5rem 0;
    }

    .task-checkbox input[type="checkbox"] {
      appearance: none;
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid var(--checkbox-color);
      border-radius: 50%;
      outline: none;
      cursor: pointer;
      margin-left: 8px;
      position: relative;
      transition: all 0.3s;
    }

    .task-checkbox input[type="checkbox"]:checked {
      background-color: var(--checkbox-color);
    }

    .task-checkbox input[type="checkbox"]:checked::after {
      content: 'âœ“';
      position: absolute;
      color: white;
      font-size: 14px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    /* Search modal */
    .search-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--modal-bg);
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      z-index: 1001;
      width: 90%;
      max-width: 500px;
    }

    .search-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .search-input-container {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .search-input {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid var(--accent);
      border-radius: 4px;
      background-color: var(--bg);
      color: var(--text-color);
    }

    .search-results {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid var(--accent);
      border-radius: 4px;
      padding: 0.5rem;
      background-color: var(--bg);
    }

    .search-result-item {
      padding: 0.5rem;
      border-bottom: 1px solid var(--accent);
      cursor: pointer;
    }

    .search-result-item:hover {
      background-color: var(--accent);
    }

    .search-result-item.highlight {
      background-color: rgba(139, 69, 19, 0.2);
    }

    .search-nav {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
    }

    /* Games Page */
    .games-page {
      display: none;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      min-height: 80vh;
    }

    .games-title {
      text-align: center;
      margin-bottom: 2rem;
      font-family: 'Dancing Script', cursive;
      font-size: 3rem;
      color: var(--primary);
    }

    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    .game-card {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border: 2px solid var(--primary);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .game-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    .game-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    .game-name {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      color: var(--primary);
    }

    .game-desc {
      font-size: 1rem;
      color: var(--text-color);
      margin-bottom: 1.5rem;
    }

    .play-btn-game {
      background-color: var(--primary);
      color: white;
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 5px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: auto;
    }

    .play-btn-game:hover {
      background-color: var(--primary-light);
      transform: translateY(-2px);
    }

    /* Game Container */
    .game-container {
      display: none;
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
      min-height: 80vh;
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }

    .game-title {
      font-size: 2rem;
      color: var(--primary);
      font-family: 'Dancing Script', cursive;
    }

    /* XO Game */
    .xo-container {
      max-width: 600px;
      margin: 0 auto;
      text-align: center;
    }

    .xo-header {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: #fff;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .xo-header h1 { 
      margin: 0; 
      font-size: 2.5em; 
      font-family: 'Tajawal', sans-serif;
    }

    #xo-scoreboard {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      background: var(--card-bg);
      color: var(--text-color);
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
      font-size: 1.2em;
      margin-bottom: 20px;
    }

    #xo-gameOptions {
      text-align: center;
      margin-bottom: 20px;
    }

    #xo-gameOptions label { 
      margin-right: 5px; 
      color: var(--text-color);
    }

    #xo-gameOptions select {
      padding: 5px;
      font-size: 1em;
      margin: 0 10px;
      background: var(--bg);
      color: var(--text-color);
      border: 1px solid var(--accent);
    }

    #xo-status { 
      text-align: center; 
      font-size: 1.5em; 
      margin-bottom: 20px; 
      color: var(--primary);
      font-weight: bold;
    }

    .xo-board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 5px;
      background: var(--card-bg);
      padding: 5px;
      border-radius: 10px;
      max-width: 320px;
      margin: 0 auto 20px;
    }

    .xo-cell {
      background: var(--bg);
      height: 100px;
      font-size: 3.5em;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      color: var(--primary);
      border-radius: 5px;
    }

    .xo-cell:hover {
      background: var(--accent);
      transform: rotate(3deg) scale(1.1);
    }

    .xo-cell.taken { cursor: not-allowed; }
    .xo-cell.winning { background: var(--success-color); color: white; }

    .xo-buttons {
      text-align: center;
      margin-bottom: 30px;
    }

    .xo-buttons button {
      padding: 10px 20px;
      font-size: 1em;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .xo-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0,0,0,0.2);
    }

    .xo-btn-new { 
      background: var(--primary); 
      color: #fff; 
    }

    .xo-btn-reset { 
      background: var(--error-color); 
      color: #fff; 
    }

    .xo-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3em;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }

    .xo-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .xo-overlay.win {
      background: rgba(46, 204, 113, 0.9);
      color: white;
      animation: animateOverlay 2s ease;
    }

    .xo-overlay.lose {
      background: rgba(231, 76, 60, 0.9);
      color: white;
      animation: animateOverlay 2s ease;
    }

    .xo-overlay.draw {
      background: rgba(255, 165, 0, 0.9);
      color: white;
      animation: animateOverlay 2s ease;
    }

    @keyframes animateOverlay {
      0% { transform: scale(0.5); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    @keyframes cellPop {
      0% { transform: scale(0); }
      90% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .xo-cell:not(.taken) { animation: cellPop 0.3s ease; }

    /* UNO Game Styles */
    .uno-container {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
    }

    .uno-header {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: #fff;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .uno-header h1 { 
      margin: 0; 
      font-size: 2.5em; 
      font-family: 'Tajawal', sans-serif;
    }

    #uno-settings {
      max-width: 500px;
      margin: 0 auto 20px;
      text-align: center;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    #mode-options { margin-bottom: 15px; }
    #mode-options .mode-option {
      display: inline-block;
      padding: 10px 20px;
      margin: 5px;
      border: 2px solid var(--primary);
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      color: var(--text-color);
      background-color: var(--bg);
    }
    #mode-options .mode-option.active {
      background-color: var(--primary);
      color: white;
      transform: translateY(-3px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }
    #mode-options input[type="radio"] { display: none; }
    #uno-settings select,
    #uno-settings button {
      margin: 10px 0;
      padding: 8px 15px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid var(--accent);
      cursor: pointer;
      background-color: var(--bg);
      color: var(--text-color);
    }
    #uno-settings button {
      background-color: var(--primary);
      color: white;
      border: none;
      transition: all 0.3s ease;
    }
    #uno-settings button:hover {
      background-color: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }

    .game-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    .game-button {
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    #uno-back {
      background: var(--primary);
      color: white;
    }
    #uno-restart {
      background: var(--error-color);
      color: white;
    }
    .game-button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }

    #uno-hands {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin-top: 20px;
      flex-wrap: nowrap;
    }
    #opponent-hand, #player-hand { width: 30%; }
    #uno-deck-center {
      width: 30%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #uno-deck-center > #uno-deck,
    #uno-deck-center > #uno-discard { margin-bottom: 20px; }
    #discard-pile {
      margin: auto;
      width: var(--card-width);
      height: var(--card-height);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      border: 3px solid var(--text-color);
    }

    /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ */
    .uno-card {
      width: var(--card-width);
      height: var(--card-height);
      border-radius: 10px;
      margin: 5px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(145deg, var(--bg), var(--card-bg));
      border: 3px solid var(--text-color);
      position: relative;
      font-size: 1.5em;
      transition: transform 0.3s ease;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    .uno-card::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 50%;
      background: rgba(255,255,255,0.4);
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
    }
    /* ØªØ­Ø¯ÙŠØ« Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ */
    .red { background: #ff3131; color: white; }
    .blue { background: #38b6ff; color: white; }
    .green { background: #82e100; color: white; }
    .yellow { background: #f6db12; color: black; }
    .wild { 
      background: linear-gradient(145deg, #8e44ad, #c0392b); 
      color: white; 
    }

    /* ØªØ£Ø«ÙŠØ± Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø§ÙˆØ³ Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ */
    .player-card:hover { 
      transform: translateY(-15px) scale(1.05);
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }

    /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
    .animate-select {
      animation: selectAnimation 0.5s ease-out forwards;
    }
    @keyframes selectAnimation {
      0% { transform: translateX(0); opacity: 1; }
      100% { transform: translateX(100%) rotate(15deg); opacity: 0; }
    }

    /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù†Ø§Øª Ù‡Ø§Ø¯Ø¦Ø© Ø¹Ù†Ø¯ Ø³Ø­Ø¨ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† */
    .animate-draw { animation: drawCardAnimation 1.5s ease; }
    @keyframes drawCardAnimation {
      0% { transform: translateY(0); opacity: 1; }
      50% { transform: translateY(-20px); opacity: 0.5; }
      100% { transform: translateY(0); opacity: 1; }
    }
    .animate-skip { animation: skipAnimation 1.5s ease; }
    @keyframes skipAnimation {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    .animate-reverse { animation: reverseAnimation 1.5s ease; }
    @keyframes reverseAnimation {
      0% { transform: rotateY(0deg); }
      50% { transform: rotateY(180deg); }
      100% { transform: rotateY(360deg); }
    }
    .animate-wild { animation: wildAnimation 1.5s ease; }
    @keyframes wildAnimation {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    .animate-draw4 { animation: draw4Animation 1.5s ease; }
    @keyframes draw4Animation {
      0% { transform: translateX(0); }
      50% { transform: translateX(20px); }
      100% { transform: translateX(0); }
    }

    /* Ø²Ø± "Ø§Ø³Ø­Ø¨ ÙˆØ±Ù‚Ø©" - ØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡ */
    #draw-card {
      position: relative;
      width: var(--card-width);
      height: var(--card-height);
      background: var(--bg);
      border: 1px solid var(--accent);
      border-radius: 10px;
      font-size: 1em;
      font-weight: bold;
      color: var(--text-color);
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #draw-card:hover { 
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }
    #draw-card::before,
    #draw-card::after {
      content: "";
      position: absolute;
      top: -5px;
      left: -5px;
      width: 100%;
      height: 100%;
      background: inherit;
      border-radius: 10px;
      z-index: -1;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    #draw-card::after { top: -10px; left: -10px; z-index: -2; }

    /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ÙˆÙ† - ØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡ */
    #colorModal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }
    #colorModal.active { display: flex; }
    .modal-content {
      background: var(--modal-bg);
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      animation: modalFadeIn 0.5s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      max-width: 90%;
      width: 400px;
    }
    @keyframes modalFadeIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    .color-options {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .color-option {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid transparent;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    .color-option:hover { 
      transform: scale(1.2);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .color-option.selected {
      border: 3px solid var(--text-color);
      transform: scale(1.1);
    }
    .color-option.red { background-color: #ff3131; }
    .color-option.blue { background-color: #38b6ff; }
    .color-option.green { background-color: #82e100; }
    .color-option.yellow { background-color: #f6db12; }

    /* ØªØºØ·ÙŠØ© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© - ØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡Ø§ */
    #endGameOverlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      flex-direction: column;
      backdrop-filter: blur(5px);
    }
    #endGameOverlay.active {
      display: flex;
      animation: fadeIn 0.5s ease;
    }
    .end-message {
      font-size: 3em;
      color: white;
      text-align: center;
      animation: scaleUp 0.5s ease;
      margin-bottom: 30px;
      text-shadow: 0 3px 10px rgba(0,0,0,0.5);
    }
    .end-button {
      padding: 12px 25px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1.2em;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
    }
    .end-button:hover {
      background: var(--primary-light);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes scaleUp { from { transform: scale(0.5); } to { transform: scale(1); } }

    /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
    .game-info {
      background: var(--card-bg);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-around;
      align-items: center;
    }
    .info-item {
      text-align: center;
    }
    .info-label {
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 5px;
    }
    .info-value {
      font-size: 1.2em;
      color: var(--text-color);
    }

    /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 768px) {
      header { flex-direction: column; padding: 1rem; }
      nav ul { margin-top: 1rem; flex-wrap: wrap; justify-content: center; }
      .toolbar { justify-content: center; }
      .main-title { font-size: 2.5rem; }
      #editor-area { min-height: 400px; }
      .header-controls {
        margin-top: 1rem;
        flex-wrap: wrap;
        justify-content: center;
      }
      .notebooks-counter {
        margin-left: 0;
        margin-top: 0.5rem;
      }
      .notebook-card {
        min-height: 180px;
      }
      .clock-widget {
        position: static;
        margin: 0.5rem auto;
        width: fit-content;
      }
      .games-grid {
        grid-template-columns: 1fr;
      }
      #xo-scoreboard {
        grid-template-columns: 1fr;
      }
      .xo-board {
        width: 250px;
        height: 250px;
      }
      
      /* UNO Responsive */
      :root {
        --card-width: 70px;
        --card-height: 100px;
      }
      #uno-hands { flex-direction: column; }
      #opponent-hand, #player-hand, #uno-deck-center { 
        width: 100%; 
        margin-bottom: 15px;
      }
      .uno-card {
        width: var(--card-width);
        height: var(--card-height);
        font-size: 1em;
      }
      .game-buttons {
        flex-direction: column;
        gap: 8px;
      }
      .game-button {
        width: 100%;
      }
      .color-option {
        width: 50px;
        height: 50px;
      }
      .end-message {
        font-size: 2em;
      }
    }

    @media (max-width: 480px) {
      .notebooks-grid {
        grid-template-columns: 1fr;
        padding: 1rem;
      }
      
      .main-title {
        font-size: 2rem;
      }
      
      .toolbar button {
        padding: 0.3rem 0.5rem;
        font-size: 0.9rem;
      }

      .modal-content {
        padding: 1.5rem;
      }

      .modal-title {
        font-size: 1.3rem;
      }

      .modal-actions {
        flex-direction: column;
      }

      .modal-btn {
        width: 100%;
      }

      .search-modal {
        width: 95%;
        padding: 1rem;
      }

      .games-title {
        font-size: 2rem;
      }

      .xo-board {
        width: 200px;
        height: 200px;
      }
      
      /* UNO Responsive */
      :root {
        --card-width: 60px;
        --card-height: 90px;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Spinner -->
  <div class="spinner" id="spinner">
    <div class="spinner-inner"></div>
  </div>

  <!-- Clock Widget -->
  <div class="clock-widget" id="clock-widget">
    <div class="clock-time" id="clock-time"></div>
    <div class="clock-date" id="clock-date"></div>
    <div class="clock-settings">
      <label for="timezone-select">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</label>
      <select id="timezone-select">
        <option value="auto">ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØµÙØ­)</option>
        <option value="UTC">UTC</option>
        <option value="UTC+3">UTC+3 (Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŒ Ù…ØµØ±)</option>
        <option value="UTC+4">UTC+4 (Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª)</option>
        <option value="UTC+2">UTC+2 (Ù„ÙŠØ¨ÙŠØ§)</option>
        <option value="UTC+1">UTC+1 (Ø§Ù„Ù…ØºØ±Ø¨ØŒ ØªÙˆÙ†Ø³)</option>
      </select>
      <label for="time-format">ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª:</label>
      <select id="time-format">
        <option value="12">12 Ø³Ø§Ø¹Ø©</option>
        <option value="24">24 Ø³Ø§Ø¹Ø©</option>
      </select>
    </div>
  </div>

  <!-- Header -->
  <header>
    <div class="logo">
      <span class="logo-icon">ğŸ“”</span>
      <span>Ù…Ø°ÙƒØ±Ø© Ø¹Ù…Ø§Ù† ğŸ´â€â˜ ï¸</span>
    </div>
    <nav>
      <ul>
        <li><a href="#" onclick="showHome()" id="home-link" class="active">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
        <li><a href="#" onclick="showEditor()" id="editor-link">Ø§Ù„Ù…ÙÙƒØ±Ø©</a></li>
        <li><button class="play-btn" onclick="showGamesPage()">
          <i class="fas fa-gamepad"></i> Ø§Ù„Ø¹Ø¨
        </button></li>
      </ul>
    </nav>
    <div class="header-controls">
      <div class="notebooks-counter" id="notebooks-counter">
        Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª: 0
      </div>
      <button class="dark-mode-toggle" onclick="toggleDarkMode()" aria-label="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†">
        <span id="dark-mode-icon">ğŸŒ™</span> Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†
      </button>
      <div class="lang-switch">
        <button onclick="changeLang('ar')" class="active" id="ar-btn">AR</button>
        <button onclick="changeLang('en')" id="en-btn">EN</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div id="home-page">
    <h1 class="main-title">Ù…ÙÙƒØ±Ø§ØªÙŠ</h1>
    
    <div class="add-notebook-container">
      <button class="add-notebook-btn" onclick="showAddNotebookModal()" aria-label="Ø¥Ø¶Ø§ÙØ© Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©">
        <span>+</span> Ø¥Ø¶Ø§ÙØ© Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
      </button>
    </div>
    
    <div class="notebooks-grid" id="notebooks-grid">
      <!-- Notebooks will be added here dynamically -->
    </div>
  </div>

  <!-- Editor -->
  <div id="editor-container" class="editor-container">
    <button class="back-btn" onclick="showHome()" aria-label="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
      <span>â†</span> Ø§Ù„Ø±Ø¬ÙˆØ¹
    </button>
    
    <section class="editor">
      <div class="toolbar">
        <button onclick="execCmd('bold')" aria-label="Ø¹Ø±ÙŠØ¶"><b>B</b></button>
        <button onclick="execCmd('italic')" aria-label="Ù…Ø§Ø¦Ù„"><i>I</i></button>
        <button onclick="execCmd('underline')" aria-label="ØªØ­ØªÙ‡ Ø®Ø·"><u>U</u></button>
        <button onclick="execCmd('insertOrderedList')" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ù…Ø±Ù‚Ù…Ø©">OL</button>
        <button onclick="execCmd('insertUnorderedList')" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ù†Ù‚Ø·ÙŠØ©">UL</button>
        <button onclick="addCheckbox()" aria-label="Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©">âœ“ Ù…Ù‡Ù…Ø©</button>
        <button onclick="insertTable()" aria-label="Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„">ğŸ“Š Ø¬Ø¯ÙˆÙ„</button>
        <button onclick="attachFile()" aria-label="Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù">ğŸ“ Ù…Ù„Ù</button>
        <button onclick="showSearchModal()" aria-label="Ø¨Ø­Ø«">ğŸ” Ø¨Ø­Ø«</button>
        <button onclick="execCmd('undo')" aria-label="ØªØ±Ø§Ø¬Ø¹">â†¶</button>
        <button onclick="execCmd('redo')" aria-label="Ø¥Ø¹Ø§Ø¯Ø©">â†·</button>
        <button onclick="triggerImage()" aria-label="Ø¥Ø¯Ø±Ø§Ø¬ ØµÙˆØ±Ø©">ğŸ–¼ï¸</button>
        <button onclick="saveContent()" aria-label="Ø­ÙØ¸ Ø§Ù„Ù…Ø­ØªÙˆÙ‰">ğŸ’¾ Ø­ÙØ¸</button>

        <div class="font-size-container">
          <span class="font-size-value">16px</span>
          <input type="range" min="10" max="100" value="16" class="font-size-slider" id="fontSizeSlider" 
                 oninput="changeFontSize(this.value)" aria-label="Ø­Ø¬Ù… Ø§Ù„Ø®Ø·">
        </div>
        
        <select onchange="execCmd('fontName', this.value)" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø®Ø·" id="font-selector">
          <!-- Arabic Fonts -->
          <optgroup label="Ø®Ø·ÙˆØ· Ø¹Ø±Ø¨ÙŠØ©">
            <option value="'Tajawal', sans-serif">Tajawal</option>
            <option value="'Amiri', serif">Amiri</option>
            <option value="'Almarai', sans-serif">Almarai</option>
            <option value="'Cairo', sans-serif">Cairo</option>
            <option value="Arial, sans-serif" style="font-family: Arial">Arial</option>
            <option value="'Times New Roman', serif" style="font-family: Times New Roman">Times New Roman</option>
          </optgroup>
          <!-- English Fonts -->
          <optgroup label="English Fonts">
            <option value="'Roboto', sans-serif">Roboto</option>
            <option value="'Open Sans', sans-serif">Open Sans</option>
            <option value="'Lato', sans-serif">Lato</option>
            <option value="'Montserrat', sans-serif">Montserrat</option>
            <option value="'Poppins', sans-serif">Poppins</option>
            <option value="'Fira Sans', sans-serif">Fira Sans</option>
            <option value="'Merriweather', serif">Merriweather</option>
            <option value="'Courier New', monospace">Courier New</option>
            <option value="'Dancing Script', cursive">Dancing Script</option>
          </optgroup>
        </select>
        
        <input type="color" onchange="execCmd('foreColor', this.value)" title="Ù„ÙˆÙ† Ø§Ù„Ù†Øµ" aria-label="Ù„ÙˆÙ† Ø§Ù„Ù†Øµ">
        <input type="color" onchange="execCmd('hiliteColor', this.value)" title="Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©" aria-label="Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©">
      </div>
      <input type="file" id="image-input" accept="image/*" style="display:none" />
      <input type="file" id="file-input" style="display:none" />
      <div id="editor-area" contenteditable="true"></div>
    </section>
  </div>

  <!-- Games Page -->
  <div id="games-page" class="games-page">
    <button class="back-btn" onclick="showHome()" aria-label="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
      <span>â†</span> Ø§Ù„Ø±Ø¬ÙˆØ¹
    </button>
    
    <h1 class="games-title">Ø§Ø³ØªØ±Ø§Ø­Ø© Ø§Ù„Ù„Ø¹Ø¨ ğŸ²ğŸ®</h1>
    
    <div class="games-grid">
      <div class="game-card" onclick="showGame('xo')">
        <div class="game-icon">â­•âŒ</div>
        <h3 class="game-name">Ù„Ø¹Ø¨Ø© XO</h3>
        <p class="game-desc">Ù„Ø¹Ø¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø´Ù‡ÙŠØ±Ø© Ø¨ÙŠÙ† Ù„Ø§Ø¹Ø¨ÙŠÙ†</p>
        <button class="play-btn-game">Ø§Ù„Ø¹Ø¨ Ø§Ù„Ø¢Ù†</button>
      </div>
      <div class="game-card" onclick="showGame('uno')">
        <div class="game-icon">ğŸƒ</div>
        <h3 class="game-name">Ù„Ø¹Ø¨Ø© UNO</h3>
        <p class="game-desc">Ù„Ø¹Ø¨Ø© Ø§Ù„ÙˆØ±Ù‚ Ø§Ù„Ø´Ù‡ÙŠØ±Ø©</p>
        <button class="play-btn-game">Ø§Ù„Ø¹Ø¨ Ø§Ù„Ø¢Ù†</button>
      </div>
    </div>
    
    <!-- Game Emojis Background -->
    <div class="game-emojis" id="game-emojis"></div>
  </div>

  <!-- XO Game Container -->
  <div id="xo-game" class="game-container">
    <div class="game-header">
      <h2 class="game-title">Ù„Ø¹Ø¨Ø© XO</h2>
      <button class="back-btn" onclick="showGamesPage()">
        <span>â†</span> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù„Ø¹Ø§Ø¨
      </button>
    </div>

      <div id="xo-scoreboard">
        <div>Ù„Ø§Ø¹Ø¨ X: <span id="scoreX">0</span></div>
        <div>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="timer">30</span></div>
        <div>Ù„Ø§Ø¹Ø¨ O: <span id="scoreO">0</span></div>
      </div>
      
      <div id="xo-gameOptions">
        <label for="modeSelect">ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø©:</label>
        <select id="modeSelect" onchange="toggleDifficulty()">
          <option value="pvp">Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ Ù„Ø§Ø¹Ø¨</option>
          <option value="bot">Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ Ø§Ù„Ø¨ÙˆØª</option>
        </select>
        <span id="difficultyContainer" style="display:none;">
          <label for="difficultySelect">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¨ÙˆØª:</label>
          <select id="difficultySelect">
            <option value="Ø³Ù‡Ù„">Ø³Ù‡Ù„</option>
            <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø·</option>
            <option value="ØµØ¹Ø¨">ØµØ¹Ø¨</option>
          </select>
        </span>
      </div>
      
      <div id="xo-status">Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ X</div>
      
      <div class="xo-board" id="board"></div>
      
      <div class="xo-buttons">
        <button class="xo-btn-new" onclick="newGame()">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        <button class="xo-btn-reset" onclick="resetScores()">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
      </div>
      
      <!-- Ø·Ø¨Ù‚Ø§Øª Ø§Ù„Ø£Ù†Ù…ÙŠØ´Ù† -->
      <div id="lostOverlay" class="xo-overlay lose">ÙˆÙŠÙŠÙˆ Ø®Ø³Ø±Øª!ğŸ¤£âŒ</div>
      <div id="winOverlay" class="xo-overlay win"> Ø§Ø³Ø³Ø³Ø³Ø³Ø³Ø³Ù„Ù… Ø·Ù„Ø¹Øª Ù„Ø¹ÙŠØ¨!ğŸ˜âœ…</div>
      <div id="drawOverlay" class="xo-overlay draw">ØªØ¹Ø§Ø¯Ù„ ÙŠØ§Ù„Ø­Ø¨ÙŠØ¨ ğŸ¤¦â€â™€ï¸ğŸ¤¦â€â™‚ï¸ğŸ”„!</div>
    </div>
  </div>


  <!-- UNO Game Container -->
  <div id="uno-game" class="game-container">
    <div class="game-header">
      <h2 class="game-title">Ù„Ø¹Ø¨Ø© UNO</h2>
      <button class="back-btn" onclick="showGamesPage()">
        <span>â†</span> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ù„Ø¹Ø§Ø¨
      </button>
    </div>

    <section id="uno" class="uno-container">
      <div id="uno-settings">
        <!-- Ø®ÙŠØ§Ø±Ø§Øª Ù†Ù…Ø· Ø§Ù„Ù„Ø¹Ø¨ Ø¯Ø§Ø®Ù„ Ù…Ø³ØªØ·ÙŠÙ„ -->
        <div id="mode-options">
          <label class="mode-option active">
            <input type="radio" name="uno-mode" value="bot" checked />
            Ù„Ø¹Ø¨ Ø¶Ø¯ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨
          </label>
          <label class="mode-option">
            <input type="radio" name="uno-mode" value="human" />
            Ù„Ø¹Ø¨ Ø¶Ø¯ Ø´Ø®Øµ
          </label>
        </div>
        <div id="uno-bot-difficulty">
          <label>
            Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨:
            <select id="uno-difficulty">
              <option value="easy">Ø³Ù‡Ù„</option>
              <option value="medium">Ù…ØªÙˆØ³Ø·</option>
              <option value="hard">ØµØ¹Ø¨</option>
            </select>
          </label>
        </div>
        <button id="uno-startGame">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
      </div>
      <div id="uno-gameArea" style="display:none;">
        <div class="game-buttons">
          <button id="uno-back" class="game-button">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
          <button id="uno-restart" class="game-button">Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„</button>
        </div>
        
        <div class="game-info">
          <div class="info-item">
            <div class="info-label">Ø¯ÙˆØ±</div>
            <div class="info-value" id="current-turn">Ø§Ù„Ù„Ø§Ø¹Ø¨ 1</div>
          </div>
          <div class="info-item">
            <div class="info-label">Ø§Ù„Ø§ØªØ¬Ø§Ù‡</div>
            <div class="info-value" id="game-direction">ÙÙŠ Ø§ØªØ¬Ø§Ù‡ Ø¹Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©</div>
          </div>
          <div class="info-item">
            <div class="info-label">Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</div>
            <div class="info-value" id="deck-count-info">0</div>
          </div>
        </div>
        
        <div id="uno-hands">
          <div id="opponent-hand">
            <h3>ÙŠØ¯ Ø§Ù„Ø®ØµÙ… (<span id="opponent-card-count">0</span>)</h3>
            <div id="opponent-cards"></div>
          </div>
          <div id="uno-deck-center">
            <div id="uno-deck">
              <button id="draw-card">
                Ø§Ø³Ø­Ø¨ ÙˆØ±Ù‚Ø© (<span id="deck-count"></span>)
              </button>
            </div>
            <div id="uno-discard">
              <h2>Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
              <div id="discard-pile" class="uno-card"></div>
            </div>
          </div>
          <div id="player-hand">
            <h3>ÙŠØ¯Ùƒ (<span id="player-card-count">0</span>)</h3>
            <div id="player-cards"></div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ÙˆÙ† -->
    <div id="colorModal">
      <div class="modal-content">
        <h2>Ø§Ø®ØªØ± Ù„ÙˆÙ†Ùƒ</h2>
        <div class="color-options">
          <div class="color-option red" data-color="red"></div>
          <div class="color-option blue" data-color="blue"></div>
          <div class="color-option green" data-color="green"></div>
          <div class="color-option yellow" data-color="yellow"></div>
        </div>
      </div>
    </div>
    
    <!-- ØªØºØ·ÙŠØ© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <div id="endGameOverlay">
      <div class="end-message"></div>
      <button class="end-button">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
  </div>

  <!-- Auto-save Indicator -->
  <div id="auto-save-indicator" class="auto-save-indicator">
    ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <!-- Rename Modal -->
  <div id="rename-modal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title">ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø°ÙƒØ±Ø©</h3>
      <input type="text" id="notebook-name-input" class="modal-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø°ÙƒØ±Ø©">
      <div class="modal-actions">
        <button class="modal-btn confirm" onclick="renameNotebook()">ØªØ£ÙƒÙŠØ¯</button>
        <button class="modal-btn cancel" onclick="hideRenameModal()">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Add Notebook Modal -->
  <div id="add-notebook-modal" class="modal">
    <div class="modal-content">
      <h3 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
      <input type="text" id="new-notebook-name" class="modal-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
      <div class="modal-actions">
        <button class="modal-btn confirm" onclick="addNewNotebook()">Ø¥Ø¶Ø§ÙØ©</button>
        <button class="modal-btn cancel" onclick="hideAddNotebookModal()">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Search Modal -->
  <div id="search-modal" class="search-modal">
    <div class="search-header">
      <h3>Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù†Øµ</h3>
      <button onclick="hideSearchModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
    </div>
    <div class="search-input-container">
      <input type="text" id="search-text" class="search-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø«...">
      <button onclick="searchText()" class="modal-btn confirm">Ø¨Ø­Ø«</button>
    </div>
    <div class="search-results" id="search-results">
      <!-- Search results will appear here -->
    </div>
    <div class="search-nav">
      <button onclick="navigateSearch(-1)" class="modal-btn cancel">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
      <button onclick="navigateSearch(1)" class="modal-btn confirm">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>
  </div>

  <script>
    // Notebooks data
    let notebooks = [];
    let currentNotebookId = null;
    let currentLang = 'ar';
    let darkMode = false;
    let autoSaveInterval;
    let autoSaveEnabled = true;
    let searchResults = [];
    let currentSearchIndex = -1;
    let clockInterval;
    let timezone = 'auto';
    let timeFormat = '12';

    // XO Game Variables
    let board = ['', '', '', '', '', '', '', '', ''];
    let currentPlayer = 'X';
    let gameActive = true;
    let winningCombinationFound = null;
    let scoreX = 0, scoreO = 0, scoreDraw = 0;
    let gameMode = "pvp";
    let botDifficulty = "Ø³Ù‡Ù„";
    const winningCombinations = [
      [0,1,2], [3,4,5], [6,7,8],
      [0,3,6], [1,4,7], [2,5,8],
      [0,4,8], [2,4,6]
    ];
    let timeLeft = 30, timerInterval;
    
    function startTimer() {
      clearInterval(timerInterval);
      timeLeft = 30;
      document.getElementById('timer').textContent = timeLeft;
      timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById('timer').textContent = timeLeft;
        if(timeLeft <= 0) { clearInterval(timerInterval); handleTimeout(); }
      }, 1000);
    }
    
    function handleTimeout() {
      gameActive = false;
      document.getElementById("xo-status").textContent = "Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!";
      if(currentPlayer === 'X') scoreO++;
      else scoreX++;
      updateScoreDisplay();
      document.getElementById("xo-status").textContent += " Ø³ÙŠØªÙ… Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§...";
      setTimeout(newGame, 3000);
    }
    
    function renderBoard() {
      const boardElement = document.getElementById("board");
      boardElement.innerHTML = '';
      board.forEach((cell, index) => {
        const cellElement = document.createElement("div");
        cellElement.classList.add("xo-cell");
        cellElement.textContent = cell;
        if(winningCombinationFound && winningCombinationFound.includes(index)) {
          cellElement.classList.add("winning");
        }
        cellElement.addEventListener("click", () => cellClicked(index));
        if(cell !== '') cellElement.classList.add("taken");
        boardElement.appendChild(cellElement);
      });
    }
    
    function cellClicked(index) {
      if(board[index] !== '' || !gameActive) return;
      if(gameMode === "bot" && currentPlayer !== 'X') return;
      board[index] = currentPlayer;
      checkWinner();
      renderBoard();
      if(gameActive) {
        if(gameMode === "bot") {
          currentPlayer = 'O';
          document.getElementById("xo-status").textContent = "Ø¯ÙˆØ± Ø§Ù„Ø¨ÙˆØª";
          setTimeout(botMove, 500);
        } else {
          currentPlayer = (currentPlayer === 'X') ? 'O' : 'X';
          document.getElementById("xo-status").textContent = `Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ ${currentPlayer}`;
        }
      }
    }
    
    function checkWinner() {
      for(let combination of winningCombinations) {
        const [a, b, c] = combination;
        if(board[a] && board[a] === board[b] && board[a] === board[c]) {
          gameActive = false;
          winningCombinationFound = combination;
          document.getElementById("xo-status").textContent = `Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ ${board[a]}!`;
          updateScore(board[a]);
          if(gameMode === "bot") {
            if(board[a] === 'X') setTimeout(showWinAnimation, 500);
            else if(board[a] === 'O') setTimeout(showLostAnimation, 500);
          }
          document.getElementById("xo-status").textContent += " Ø³ÙŠØªÙ… Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§...";
          setTimeout(newGame, 3000);
          return;
        }
      }
      if(!board.includes('')) {
        gameActive = false;
        document.getElementById("xo-status").textContent = "Ø§Ù„ØªØ¹Ø§Ø¯Ù„!";
        updateScore('draw');
        showDrawAnimation();
        document.getElementById("xo-status").textContent += " Ø³ÙŠØªÙ… Ø¨Ø¯Ø¡ Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§...";
        setTimeout(newGame, 3000);
      }
    }
    
    function updateScore(winner) {
      if(winner === 'X') { scoreX++; document.getElementById("scoreX").textContent = scoreX; }
      else if(winner === 'O') { scoreO++; document.getElementById("scoreO").textContent = scoreO; }
      else if(winner === 'draw') { scoreDraw++; }
      localStorage.setItem('ticTacToeScores', JSON.stringify({ X: scoreX, O: scoreO, draw: scoreDraw }));
    }
    
    function updateScoreDisplay() {
      document.getElementById("scoreX").textContent = scoreX;
      document.getElementById("scoreO").textContent = scoreO;
    }
    
    function newGame() {
      clearInterval(timerInterval);
      gameMode = document.getElementById("modeSelect").value;
      if(gameMode === "bot") { botDifficulty = document.getElementById("difficultySelect").value; }
      board = ['', '', '', '', '', '', '', '', ''];
      currentPlayer = 'X';
      gameActive = true;
      winningCombinationFound = null;
      document.getElementById("xo-status").textContent = "Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ X";
      renderBoard();
      startTimer();
    }
    
    function resetScores() {
      scoreX = scoreO = scoreDraw = 0;
      updateScoreDisplay();
      localStorage.removeItem('ticTacToeScores');
      newGame();
    }
    
    function botMove() {
      if(!gameActive) return;
      let move;
      if(botDifficulty === 'Ø³Ù‡Ù„') move = getRandomMove();
      else if(botDifficulty === 'Ù…ØªÙˆØ³Ø·') move = mediumBotMove();
      else if(botDifficulty === 'ØµØ¹Ø¨') move = bestMove();
      board[move] = 'O';
      checkWinner();
      if(gameActive) { currentPlayer = 'X'; document.getElementById("xo-status").textContent = "Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ X"; }
      renderBoard();
    }
    
    function getAvailableMoves(bd = board) {
      let moves = [];
      for(let i = 0; i < bd.length; i++) { if(bd[i] === '') moves.push(i); }
      return moves;
    }
    
    function getRandomMove() {
      let moves = getAvailableMoves();
      return moves[Math.floor(Math.random() * moves.length)];
    }
    
    function mediumBotMove() {
      let moves = getAvailableMoves();
      for(let i = 0; i < moves.length; i++) {
        let idx = moves[i];
        board[idx] = 'O';
        if(checkWinnerForBoard(board) === 'O') { board[idx] = ''; return idx; }
        board[idx] = '';
      }
      for(let i = 0; i < moves.length; i++) {
        let idx = moves[i];
        board[idx] = 'X';
        if(checkWinnerForBoard(board) === 'X') { board[idx] = ''; return idx; }
        board[idx] = '';
      }
      return getRandomMove();
    }
    
    function bestMove() {
      let bestScore = -Infinity, move;
      let moves = getAvailableMoves();
      for(let i = 0; i < moves.length; i++) {
        let idx = moves[i];
        board[idx] = 'O';
        let score = minimax(board, 0, false);
        board[idx] = '';
        if(score > bestScore) { bestScore = score; move = idx; }
      }
      return move;
    }
    
    function minimax(bd, depth, isMaximizing) {
      let result = checkWinnerForBoard(bd);
      if(result !== null) {
        if(result === 'O') return 10 - depth;
        else if(result === 'X') return depth - 10;
        else if(result === 'draw') return 0;
      }
      if(isMaximizing) {
        let bestScore = -Infinity;
        let moves = getAvailableMoves(bd);
        for(let i = 0; i < moves.length; i++) {
          bd[moves[i]] = 'O';
          let score = minimax(bd, depth + 1, false);
          bd[moves[i]] = '';
          bestScore = Math.max(score, bestScore);
        }
        return bestScore;
      } else {
        let bestScore = Infinity;
        let moves = getAvailableMoves(bd);
        for(let i = 0; i < moves.length; i++) {
          bd[moves[i]] = 'X';
          let score = minimax(bd, depth + 1, true);
          bd[moves[i]] = '';
          bestScore = Math.min(score, bestScore);
        }
        return bestScore;
      }
    }
    
    function checkWinnerForBoard(bd) {
      for(let combination of winningCombinations) {
        const [a, b, c] = combination;
        if(bd[a] && bd[a] === bd[b] && bd[a] === bd[c]) return bd[a];
      }
      if(!bd.includes('')) return 'draw';
      return null;
    }
    
    function toggleDifficulty() {
      let mode = document.getElementById("modeSelect").value;
      let diffContainer = document.getElementById("difficultyContainer");
      if(mode === "bot") { diffContainer.style.display = "inline"; }
      else { diffContainer.style.display = "none"; }
    }
    
    function showLostAnimation() {
      const lostOverlay = document.getElementById("lostOverlay");
      lostOverlay.classList.add("active");
      setTimeout(() => { lostOverlay.classList.remove("active"); }, 2000);
    }
    
    function showWinAnimation() {
      const winOverlay = document.getElementById("winOverlay");
      winOverlay.classList.add("active");
      setTimeout(() => { winOverlay.classList.remove("active"); }, 2000);
    }
    
    function showDrawAnimation() {
      const drawOverlay = document.getElementById("drawOverlay");
      drawOverlay.classList.add("active");
      setTimeout(() => { drawOverlay.classList.remove("active"); }, 2000);
    }

    // UNO Game Variables and Functions
    const UNOGame = {
      deck: [],
      players: [[], []],
      discardPile: [],
      currentPlayer: 0,
      mode: "bot",
      difficulty: "easy",
      direction: 1,
      gameStarted: false,
      init() { 
        this.setupEventListeners();
      },
      setupEventListeners() {
        document.querySelectorAll('#mode-options input[name="uno-mode"]').forEach((radio) => {
          radio.addEventListener("change", () => {
            document.querySelectorAll("#mode-options .mode-option").forEach((label) => label.classList.remove("active"));
            radio.parentElement.classList.add("active");
            this.mode = radio.value;
            const botDiff = document.getElementById("uno-bot-difficulty");
            botDiff.style.display = this.mode === "bot" ? "block" : "none";
          });
        });
        
        document.getElementById("uno-difficulty").addEventListener("change", (e) => { 
          this.difficulty = e.target.value; 
        });
        
        document.getElementById("uno-startGame").addEventListener("click", () => { 
          this.startGame(); 
        });
        
        document.getElementById("draw-card").addEventListener("click", () => {
          if (this.isCurrentPlayerHuman()) {
            this.drawCard(this.currentPlayer);
            this.updateUI();
            this.nextTurn();
          }
        });
        
        document.getElementById("uno-back").addEventListener("click", () => { 
          this.backToSettings(); 
        });
        
        document.getElementById("uno-restart").addEventListener("click", () => {
          if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©ØŸ")) {
            this.startGame();
          }
        });
        
        document.querySelector("#endGameOverlay .end-button").addEventListener("click", () => {
          document.getElementById("endGameOverlay").classList.remove("active");
          this.backToSettings();
        });
      },
      startGame() {
        this.gameStarted = true;
        document.getElementById("uno-settings").style.display = "none";
        document.getElementById("uno-gameArea").style.display = "block";
        this.deck = this.generateDeck();
        this.shuffle(this.deck);
        this.players = [[], []];
        for (let i = 0; i < 7; i++) {
          this.players[0].push(this.deck.pop());
          this.players[1].push(this.deck.pop());
        }
        let firstCard = this.deck.pop();
        // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„ÙŠØ³Øª Ø®Ø§ØµØ©
        while (["Wild", "WildDraw4", "+2", "Skip", "Reverse"].includes(firstCard.value)) {
          this.deck.unshift(firstCard);
          this.shuffle(this.deck);
          firstCard = this.deck.pop();
        }
        this.discardPile = [firstCard];
        this.currentPlayer = 0;
        this.direction = 1;
        this.updateUI();
        if (!this.isCurrentPlayerHuman()) {
          setTimeout(() => this.botMove(), 1000);
        }
      },
      backToSettings() {
        document.getElementById("uno-settings").style.display = "block";
        document.getElementById("uno-gameArea").style.display = "none";
        this.deck = [];
        this.players = [[], []];
        this.discardPile = [];
        this.currentPlayer = 0;
        this.direction = 1;
        this.gameStarted = false;
      },
      generateDeck() {
        const colors = ["red", "blue", "green", "yellow"];
        const numbers = ["0","1","2","3","4","5","6","7","8","9"];
        const specials = ["Skip", "Reverse", "+2"];
        let deck = [];
        colors.forEach((color) => {
          deck.push({ color: color, value: "0" });
          for (let i = 1; i < numbers.length; i++) {
            deck.push({ color: color, value: numbers[i] });
            deck.push({ color: color, value: numbers[i] });
          }
          specials.forEach((special) => {
            deck.push({ color: color, value: special });
            deck.push({ color: color, value: special });
          });
        });
        for (let i = 0; i < 4; i++) {
          deck.push({ color: "wild", value: "Wild" });
          deck.push({ color: "wild", value: "WildDraw4" });
        }
        return deck;
      },
      shuffle(deck) {
        for (let i = deck.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [deck[i], deck[j]] = [deck[j], deck[i]];
        }
      },
      updateUI() {
        document.getElementById("deck-count").textContent = this.deck.length;
        document.getElementById("deck-count-info").textContent = this.deck.length;
        document.getElementById("player-card-count").textContent = this.players[0].length;
        document.getElementById("opponent-card-count").textContent = this.players[1].length;
        
        const topCard = this.discardPile[this.discardPile.length - 1];
        const discardElem = document.getElementById("discard-pile");
        discardElem.textContent = topCard.value;
        discardElem.className = topCard.color === "wild" ? "uno-card wild" : "uno-card " + topCard.color;
        
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯ÙˆØ±
        const turnElem = document.getElementById("current-turn");
        if (this.mode === "bot") {
          turnElem.textContent = this.currentPlayer === 0 ? "Ø¯ÙˆØ±Ùƒ" : "Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ø³ÙˆØ¨";
        } else {
          turnElem.textContent = `Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ ${this.currentPlayer + 1}`;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØ¬Ø§Ù‡
        const directionElem = document.getElementById("game-direction");
        directionElem.textContent = this.direction === 1 ? "ÙÙŠ Ø§ØªØ¬Ø§Ù‡ Ø¹Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©" : "Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø¹Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©";
        
        const playerCardsDiv = document.getElementById("player-cards");
        playerCardsDiv.innerHTML = "";
        this.players[0].forEach((card, index) => {
          const cardElem = document.createElement("div");
          cardElem.className = card.color === "wild" ? "uno-card wild player-card" : "uno-card " + card.color + " player-card";
          cardElem.textContent = card.value;
          cardElem.addEventListener("click", () => {
            if (this.isCurrentPlayerHuman()) {
              cardElem.classList.add("animate-select");
              setTimeout(() => { this.playCard(0, index); }, 500);
            }
          });
          playerCardsDiv.appendChild(cardElem);
        });
        
        const opponentCardsDiv = document.getElementById("opponent-cards");
        opponentCardsDiv.innerHTML = "";
        if (this.mode === "bot") {
          for (let i = 0; i < this.players[1].length; i++) {
            const cardElem = document.createElement("div");
            cardElem.className = "uno-card";
            cardElem.style.background = "#555";
            cardElem.textContent = "?";
            opponentCardsDiv.appendChild(cardElem);
          }
        } else {
          this.players[1].forEach((card) => {
            const cardElem = document.createElement("div");
            cardElem.className = card.color === "wild" ? "uno-card wild" : "uno-card " + card.color;
            cardElem.textContent = card.value;
            cardElem.addEventListener("click", () => {
              if (!this.isCurrentPlayerHuman()) {
                this.playCard(1, this.players[1].indexOf(card));
              }
            });
            opponentCardsDiv.appendChild(cardElem);
          });
        }
      },
      isCurrentPlayerHuman() {
        return this.mode === "bot" ? this.currentPlayer === 0 : this.currentPlayer === 0;
      },
      getValidMoves(hand) {
        const topCard = this.discardPile[this.discardPile.length - 1];
        return hand.map((card, index) => {
          if (card.color === "wild") return index;
          return (card.color === topCard.color || card.value === topCard.value) ? index : -1;
        }).filter((index) => index !== -1);
      },
      playCard(playerIndex, cardIndex) {
        const hand = this.players[playerIndex];
        const card = hand[cardIndex];
        const topCard = this.discardPile[this.discardPile.length - 1];
        
        if (card.color === "wild" || card.color === topCard.color || card.value === topCard.value) {
          hand.splice(cardIndex, 1);
          this.discardPile.push(card);
          this.updateUI();
          
          if (this.checkWin()) return;
          
          // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
          switch(card.value) {
            case "+2":
              this.animatePlusTwo(() => {
                const opponentIndex = playerIndex === 0 ? 1 : 0;
                this.drawCard(opponentIndex);
                this.drawCard(opponentIndex);
                this.updateUI();
                this.nextTurn();
              });
              return;
              
            case "Skip":
              this.animateSkip(() => { this.nextTurn(); });
              return;
              
            case "Reverse":
              this.animateReverse(() => {
                this.direction *= -1;
                this.nextTurn();
              });
              return;
              
            case "Wild":
              this.animateWild(() => {
                if (this.isCurrentPlayerHuman()) {
                  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¨Ø´Ø±ÙŠ Ù‡Ùˆ Ù…Ù† Ù„Ø¹Ø¨ Ø§Ù„ÙˆØ±Ù‚Ø©ØŒ ÙŠØ¹Ø±Ø¶ Ù„Ù‡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†
                  showColorSelection().then((chosenColor) => {
                    this.discardPile[this.discardPile.length - 1].color = chosenColor;
                    this.updateUI();
                    this.nextTurn();
                  });
                } else {
                  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®ØµÙ… (Ø§Ù„Ø­Ø§Ø³ÙˆØ¨) Ù‡Ùˆ Ù…Ù† Ù„Ø¹Ø¨ Ø§Ù„ÙˆØ±Ù‚Ø©ØŒ ÙŠØ®ØªØ§Ø± Ù„ÙˆÙ†Ù‹Ø§ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§
                  const colors = ["red", "blue", "green", "yellow"];
                  const chosenColor = colors[Math.floor(Math.random() * colors.length)];
                  setTimeout(() => {
                    this.discardPile[this.discardPile.length - 1].color = chosenColor;
                    this.updateUI();
                    this.nextTurn();
                  }, 1000);
                }
              });
              return;
              
            case "WildDraw4":
              this.animateDraw4(() => {
                if (this.isCurrentPlayerHuman()) {
                  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¨Ø´Ø±ÙŠ Ù‡Ùˆ Ù…Ù† Ù„Ø¹Ø¨ Ø§Ù„ÙˆØ±Ù‚Ø©ØŒ ÙŠØ¹Ø±Ø¶ Ù„Ù‡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†
                  showColorSelection().then((chosenColor) => {
                    this.discardPile[this.discardPile.length - 1].color = chosenColor;
                    const opponentIndex = this.currentPlayer === 0 ? 1 : 0;
                    for (let i = 0; i < 4; i++) {
                      this.drawCard(opponentIndex);
                    }
                    this.updateUI();
                    this.nextTurn();
                  });
                } else {
                  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø®ØµÙ… (Ø§Ù„Ø­Ø§Ø³ÙˆØ¨) Ù‡Ùˆ Ù…Ù† Ù„Ø¹Ø¨ Ø§Ù„ÙˆØ±Ù‚Ø©ØŒ ÙŠØ®ØªØ§Ø± Ù„ÙˆÙ†Ù‹Ø§ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§
                  const colors = ["red", "blue", "green", "yellow"];
                  const chosenColor = colors[Math.floor(Math.random() * colors.length)];
                  setTimeout(() => {
                    this.discardPile[this.discardPile.length - 1].color = chosenColor;
                    const opponentIndex = this.currentPlayer === 0 ? 1 : 0;
                    for (let i = 0; i < 4; i++) {
                      this.drawCard(opponentIndex);
                    }
                    this.updateUI();
                    this.nextTurn();
                  }, 1000);
                }
              });
              return;
              
            default:
              this.nextTurn();
          }
        } else {
          alert("Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø¹Ø¨ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©!");
        }
      },
      drawCard(playerIndex) {
        if (this.deck.length === 0) {
          const top = this.discardPile.pop();
          this.deck = this.discardPile;
          this.shuffle(this.deck);
          this.discardPile = [top];
        }
        const card = this.deck.pop();
        this.players[playerIndex].push(card);
      },
      nextTurn() {
        this.currentPlayer = (this.currentPlayer + this.direction + this.players.length) % this.players.length;
        this.updateUI();
        
        if (!this.isCurrentPlayerHuman()) {
          setTimeout(() => this.botMove(), 1000);
        }
      },
      botMove() {
        if (!this.gameStarted) return;
        
        const hand = this.players[1];
        const validMoves = this.getValidMoves(hand);
        
        if (validMoves.length > 0) {
          let chosenIndex;
          
          if (this.difficulty === "easy") {
            chosenIndex = validMoves[Math.floor(Math.random() * validMoves.length)];
          } 
          else if (this.difficulty === "medium") {
            // Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù…ØªÙˆØ³Ø·Ø©: ØªÙØ¶ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
            const specialCards = validMoves.filter(index => 
              ["+2", "Skip", "Reverse", "Wild", "WildDraw4"].includes(hand[index].value)
            );
            chosenIndex = specialCards.length > 0 
              ? specialCards[Math.floor(Math.random() * specialCards.length)]
              : validMoves[Math.floor(Math.random() * validMoves.length)];
          }
          else { // ØµØ¹Ø¨Ø©
            // Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© ØµØ¹Ø¨Ø©: ØªÙØ¶ÙŠÙ„ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¥Ù„Ù‰ Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ù‹Ø§
            let colorCount = { red: 0, blue: 0, green: 0, yellow: 0 };
            hand.forEach((card) => { 
              if (card.color in colorCount) colorCount[card.color]++;
            });
            
            // ØªÙØ¶ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªÙŠ ØªØ³Ø¨Ø¨ Ø¶Ø±Ø±Ù‹Ø§ Ù„Ù„Ø®ØµÙ…
            const harmfulCards = validMoves.filter(index => 
              ["+2", "Skip", "WildDraw4"].includes(hand[index].value)
            );
            
            if (harmfulCards.length > 0) {
              chosenIndex = harmfulCards[0];
            } else {
              chosenIndex = validMoves[0];
              let maxCount = -1;
              validMoves.forEach((index) => {
                const card = hand[index];
                if (card.color in colorCount && colorCount[card.color] > maxCount) {
                  maxCount = colorCount[card.color];
                  chosenIndex = index;
                }
              });
            }
          }
          
          this.playCard(1, chosenIndex);
        } else {
          this.drawCard(1);
          this.updateUI();
          const newValid = this.getValidMoves(this.players[1]);
          if (newValid.length > 0) {
            setTimeout(() => this.botMove(), 1000);
          } else {
            this.nextTurn();
          }
        }
      },
      checkWin() {
        if (this.players[0].length === 0) {
          this.endGame("player");
          return true;
        } else if (this.players[1].length === 0) {
          this.endGame("opponent");
          return true;
        }
        return false;
      },
      endGame(winner) {
        let message = "";
        if (this.mode === "bot") {
          message = winner === "player" ? "ğŸ‰ Ù„Ø¹ÙŠØ¨ Ù…Ø§Ø´Ø§Ø¡Ø§Ù„Ù„Ù‡! ğŸ˜‚" : " ğŸ¥±Ø¹ÙˆØ§ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø¬Ø§ÙŠØ©! ";
        } else {
          message = winner === "player" ? "ğŸ‰ ÙØ§Ø² Ø§Ù„Ù„Ø§Ø¹Ø¨ 1! ğŸ‰" : "ğŸ‰ ÙØ§Ø² Ø§Ù„Ù„Ø§Ø¹Ø¨ 2! ğŸ‰";
        }
        const overlay = document.getElementById("endGameOverlay");
        const endMessageDiv = overlay.querySelector(".end-message");
        endMessageDiv.textContent = message;
        overlay.classList.add("active");
      },
      animatePlusTwo(callback) {
        const opponentCardsDiv = document.getElementById("opponent-cards");
        opponentCardsDiv.classList.add("animate-draw");
        setTimeout(() => {
          opponentCardsDiv.classList.remove("animate-draw");
          callback();
        }, 1500);
      },
      animateSkip(callback) {
        const discardElem = document.getElementById("discard-pile");
        discardElem.classList.add("animate-skip");
        setTimeout(() => {
          discardElem.classList.remove("animate-skip");
          callback();
        }, 1500);
      },
      animateReverse(callback) {
        const discardElem = document.getElementById("discard-pile");
        discardElem.classList.add("animate-reverse");
        setTimeout(() => {
          discardElem.classList.remove("animate-reverse");
          callback();
        }, 1500);
      },
      animateWild(callback) {
        const discardElem = document.getElementById("discard-pile");
        discardElem.classList.add("animate-wild");
        setTimeout(() => {
          discardElem.classList.remove("animate-wild");
          callback();
        }, 1500);
      },
      animateDraw4(callback) {
        const discardElem = document.getElementById("discard-pile");
        discardElem.classList.add("animate-draw4");
        setTimeout(() => {
          discardElem.classList.remove("animate-draw4");
          callback();
        }, 1500);
      }
    };

    function showColorSelection() {
      return new Promise((resolve) => {
        const modal = document.getElementById("colorModal");
        modal.classList.add("active");
        const options = modal.querySelectorAll(".color-option");
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
        options.forEach(opt => opt.classList.remove("selected"));
        
        options.forEach((option) => {
          option.onclick = function () {
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ­Ø¯ÙŠØ¯
            options.forEach(opt => opt.classList.remove("selected"));
            this.classList.add("selected");
            
            setTimeout(() => {
              const selectedColor = this.getAttribute("data-color");
              modal.classList.remove("active");
              resolve(selectedColor);
            }, 300);
          };
        });
      });
    }

    // Load saved notebooks and content on page load
    window.onload = function() {
      const savedDarkMode = localStorage.getItem('darkMode') === 'true';
      if (savedDarkMode) {
        toggleDarkMode(false);
      }
      
      // Load clock settings
      const savedTimezone = localStorage.getItem('timezone');
      const savedTimeFormat = localStorage.getItem('timeFormat');
      if (savedTimezone) timezone = savedTimezone;
      if (savedTimeFormat) timeFormat = savedTimeFormat;
      
      // Set dropdown values
      document.getElementById('timezone-select').value = timezone;
      document.getElementById('time-format').value = timeFormat;
      
      showHome();
      loadNotebooks();
      changeFontSize(16);
      setupAutoSave();
      updateNotebooksCounter();
      updateClock();
      setupClock();
      createGameEmojis();
      
      // Initialize XO game
      const savedScores = JSON.parse(localStorage.getItem('ticTacToeScores'));
      if(savedScores) {
        scoreX = savedScores.X || 0;
        scoreO = savedScores.O || 0;
        scoreDraw = savedScores.draw || 0;
        updateScoreDisplay();
      }
      renderBoard();
      
      // Initialize UNO game
      UNOGame.init();
      
      // Clock widget click handler
      document.getElementById('clock-widget').addEventListener('click', function(e) {
        if (e.target.closest('.clock-settings')) return;
        this.classList.toggle('active');
      });
    };

    // Create floating game emojis
    function createGameEmojis() {
      const emojis = ['ğŸ®', 'ğŸ•¹ï¸', 'ğŸ‘¾', 'ğŸ²', 'â™Ÿï¸', 'ğŸ¯', 'ğŸ§©', 'ğŸƒ', 'ğŸ€„', 'ğŸ³'];
      const container = document.getElementById('game-emojis');
      
      for (let i = 0; i < 15; i++) {
        const emoji = document.createElement('div');
        emoji.className = 'game-emoji';
        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        
        // Random position
        emoji.style.left = Math.random() * 100 + '%';
        emoji.style.top = Math.random() * 100 + '%';
        
        // Random animation duration and delay
        emoji.style.animationDuration = 5 + Math.random() * 10 + 's';
        emoji.style.animationDelay = Math.random() * 5 + 's';
        
        container.appendChild(emoji);
      }
    }

    // Show games page
    function showGamesPage() {
      hideAllPages();
      document.getElementById('games-page').style.display = 'block';
      document.getElementById('home-link').classList.remove('active');
      document.getElementById('editor-link').classList.remove('active');
    }

    // Show specific game
    function showGame(game) {
      hideAllPages();
      if (game === 'xo') {
        document.getElementById('xo-game').style.display = 'block';
        newGame();
      } else if (game === 'uno') {
        document.getElementById('uno-game').style.display = 'block';
        UNOGame.backToSettings();
      }
    }

    // Hide all pages
    function hideAllPages() {
      document.getElementById('home-page').style.display = 'none';
      document.getElementById('editor-container').style.display = 'none';
      document.getElementById('games-page').style.display = 'none';
      document.getElementById('xo-game').style.display = 'none';
      document.getElementById('uno-game').style.display = 'none';
    }

    function showLoading(show) {
      const spinner = document.getElementById('spinner');
      spinner.style.display = show ? 'flex' : 'none';
    }

    function showToast(message, isError = false) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = isError ? 'toast error show' : 'toast show';
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function sanitizeInput(input) {
      return input.replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    function updateNotebooksCounter() {
      const counter = document.getElementById('notebooks-counter');
      counter.textContent = currentLang === 'ar' 
        ? `Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª: ${notebooks.length}`
        : `Notebooks: ${notebooks.length}`;
    }

    function setupAutoSave() {
      if (autoSaveInterval) clearInterval(autoSaveInterval);
      
      autoSaveInterval = setInterval(() => {
        if (autoSaveEnabled && currentNotebookId) {
          autoSaveContent();
        }
      }, 30000);
    }

    function autoSaveContent() {
      if (currentNotebookId) {
        const content = document.getElementById('editor-area').innerHTML;
        const notebook = notebooks.find(n => n.id === currentNotebookId);
        if (notebook && notebook.content !== content) {
          notebook.content = content;
          notebook.lastEdited = new Date().toLocaleString();
          saveNotebooks();
          
          const indicator = document.getElementById('auto-save-indicator');
          indicator.textContent = currentLang === 'ar' ? 'ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§' : 'Auto-saved';
          indicator.classList.add('show');
          setTimeout(() => indicator.classList.remove('show'), 2000);
        }
      }
    }

    function toggleDarkMode(shouldSave = true) {
      darkMode = !darkMode;
      document.body.classList.toggle('dark-mode', darkMode);
      
      const icon = document.getElementById('dark-mode-icon');
      icon.textContent = darkMode ? 'â˜€ï¸' : 'ğŸŒ™';
      
      const button = document.querySelector('.dark-mode-toggle');
      button.innerHTML = `<span id="dark-mode-icon">${darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}</span> ${darkMode ? 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­' : 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†'}`;
      
      if (shouldSave) {
        localStorage.setItem('darkMode', darkMode);
      }
    }

    function loadNotebooks() {
      showLoading(true);
      try {
        const savedNotebooks = localStorage.getItem('notebooks');
        if (savedNotebooks) {
          notebooks = JSON.parse(savedNotebooks).filter(n => n.id && n.name);
          notebooks.sort((a, b) => (b.pinned || false) - (a.pinned || false));
          renderNotebooks();
        } else {
          addDefaultNotebook();
        }
      } catch (e) {
        console.error('Error loading notebooks:', e);
        showToast(currentLang === 'ar' ? 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª' : 'Error loading notebooks', true);
        addDefaultNotebook();
      } finally {
        showLoading(false);
      }
    }

    function addDefaultNotebook() {
      const defaultNotebook = {
        id: generateId(),
        name: 'Ø§Ù„Ù…ÙÙƒØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©',
        lastEdited: new Date().toLocaleString(),
        content: '',
        pinned: false,
        rating: 0
      };
      notebooks.push(defaultNotebook);
      saveNotebooks();
      renderNotebooks();
    }

    function renderNotebooks() {
      const grid = document.getElementById('notebooks-grid');
      grid.innerHTML = '';
      
      notebooks.sort((a, b) => (b.pinned || false) - (a.pinned || false));
      
      notebooks.forEach(notebook => {
        const notebookElement = document.createElement('div');
        notebookElement.className = `notebook-card ${notebook.pinned ? 'pinned' : ''}`;
        notebookElement.setAttribute('data-id', notebook.id);
        notebookElement.onclick = () => openNotebook(notebook.id);
        
        // Create rating stars
        let starsHtml = '';
        for (let i = 1; i <= 5; i++) {
          starsHtml += `<span class="star" onclick="rateNotebook(event, '${notebook.id}', ${i})">${i <= notebook.rating ? 'â˜…' : 'â˜†'}</span>`;
        }
        
        notebookElement.innerHTML = `
          <div class="notebook-menu" onclick="event.stopPropagation(); toggleMenu(this)" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª">â‹®
            <div class="menu-dropdown">
              <button onclick="showRenameModal('${notebook.id}')">${currentLang === 'ar' ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…' : 'Rename'}</button>
              <button onclick="togglePinNotebook('${notebook.id}')">${notebook.pinned ? (currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª' : 'Unpin') : (currentLang === 'ar' ? 'ØªØ«Ø¨ÙŠØª' : 'Pin')}</button>
              <button onclick="deleteNotebook('${notebook.id}')">${currentLang === 'ar' ? 'Ø­Ø°Ù' : 'Delete'}</button>
            </div>
          </div>
          <h3>${sanitizeInput(notebook.name)}</h3>
          <div class="notebook-rating">${starsHtml}</div>
          <p>${currentLang === 'ar' ? 'Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„: ' : 'Last edited: '}${notebook.lastEdited}</p>
          <div class="notebook-actions">
            <button class="notebook-btn pin-btn" onclick="event.stopPropagation(); togglePinNotebook('${notebook.id}')">
              ${notebook.pinned ? (currentLang === 'ar' ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª' : 'Unpin') : (currentLang === 'ar' ? 'ØªØ«Ø¨ÙŠØª' : 'Pin')}
            </button>
          </div>
        `;
        
        grid.appendChild(notebookElement);
      });
      
      updateNotebooksCounter();
    }

    function rateNotebook(event, notebookId, rating) {
      event.stopPropagation();
      const notebook = notebooks.find(n => n.id === notebookId);
      if (notebook) {
        notebook.rating = rating;
        saveNotebooks();
        renderNotebooks();
        showToast(
          currentLang === 'ar' 
            ? `ØªÙ… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ø¨Ù€ ${rating} Ù†Ø¬ÙˆÙ…` 
            : `Notebook rated ${rating} stars`
        );
      }
    }

    function togglePinNotebook(notebookId) {
      const notebook = notebooks.find(n => n.id === notebookId);
      if (notebook) {
        notebook.pinned = !notebook.pinned;
        saveNotebooks();
        renderNotebooks();
        showToast(
          currentLang === 'ar' 
            ? `ØªÙ… ${notebook.pinned ? 'ØªØ«Ø¨ÙŠØª' : 'Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª'} Ø§Ù„Ù…Ø°ÙƒØ±Ø©` 
            : `Notebook ${notebook.pinned ? 'pinned' : 'unpinned'}`
        );
      }
    }

    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    function saveNotebooks() {
      try {
        localStorage.setItem('notebooks', JSON.stringify(notebooks));
        updateNotebooksCounter();
      } catch (e) {
        console.error('Error saving notebooks:', e);
        showToast(currentLang === 'ar' ? 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª' : 'Error saving notebooks', true);
      }
    }

    function showHome() {
      hideAllPages();
      document.getElementById('home-page').style.display = 'block';
      
      // Update active nav link
      document.getElementById('home-link').classList.add('active');
      document.getElementById('editor-link').classList.remove('active');
    }
    
    function showEditor(notebookId = null) {
      hideAllPages();
      document.getElementById('editor-container').style.display = 'block';
      
      // Update active nav link
      document.getElementById('editor-link').classList.add('active');
      document.getElementById('home-link').classList.remove('active');
      
      if (notebookId) openNotebook(notebookId);
    }
    
    function openNotebook(notebookId) {
      const notebook = notebooks.find(n => n.id === notebookId);
      if (notebook) {
        currentNotebookId = notebookId;
        document.getElementById('editor-area').innerHTML = notebook.content || '';
        showEditor();
      }
    }
    
    function showAddNotebookModal() {
      document.getElementById('new-notebook-name').value = '';
      document.getElementById('add-notebook-modal').style.display = 'flex';
      document.getElementById('new-notebook-name').focus();
    }

    function hideAddNotebookModal() {
      document.getElementById('add-notebook-modal').style.display = 'none';
    }

    function addNewNotebook() {
      const nameInput = document.getElementById('new-notebook-name');
      const name = sanitizeInput(nameInput.value.trim()) || (currentLang === 'ar' ? 'Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©' : 'New Notebook');
      
      const newNotebook = {
        id: generateId(),
        name: name,
        lastEdited: new Date().toLocaleString(),
        content: '',
        pinned: false,
        rating: 0
      };
      
      notebooks.push(newNotebook);
      saveNotebooks();
      renderNotebooks();
      hideAddNotebookModal();
      openNotebook(newNotebook.id);
      
      showToast(
        currentLang === 'ar' 
          ? 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­' 
          : 'New notebook created successfully'
      );
    }

    function showRenameModal(notebookId) {
      const notebook = notebooks.find(n => n.id === notebookId);
      if (notebook) {
        document.getElementById('notebook-name-input').value = notebook.name;
        document.getElementById('notebook-name-input').setAttribute('data-id', notebookId);
        document.getElementById('rename-modal').style.display = 'flex';
        document.getElementById('notebook-name-input').focus();
      }
    }

    function hideRenameModal() {
      document.getElementById('rename-modal').style.display = 'none';
    }

    function renameNotebook() {
      const nameInput = document.getElementById('notebook-name-input');
      const notebookId = nameInput.getAttribute('data-id');
      const newName = sanitizeInput(nameInput.value.trim());
      
      if (newName && notebookId) {
        const notebook = notebooks.find(n => n.id === notebookId);
        if (notebook) {
          notebook.name = newName;
          notebook.lastEdited = new Date().toLocaleString();
          saveNotebooks();
          renderNotebooks();
          hideRenameModal();
          showToast(
            currentLang === 'ar' 
              ? 'ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­' 
              : 'Notebook renamed successfully'
          );
        }
      } else {
        showToast(
          currentLang === 'ar' 
            ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ØµØ­ÙŠØ­ Ù„Ù„Ù…Ø°ÙƒØ±Ø©' 
            : 'Please enter a valid notebook name', 
          true
        );
      }
    }

    function deleteNotebook(notebookId) {
      const confirmMsg = currentLang === 'ar' 
        ? 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙÙƒØ±Ø©ØŸ'
        : 'Are you sure you want to delete this notebook?';
      
      if (confirm(confirmMsg)) {
        const notebookName = notebooks.find(n => n.id === notebookId)?.name || '';
        notebooks = notebooks.filter(n => n.id !== notebookId);
        saveNotebooks();
        renderNotebooks();
        
        if (currentNotebookId === notebookId) showHome();
        
        showToast(
          currentLang === 'ar' 
            ? `ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø°ÙƒØ±Ø© "${notebookName}"` 
            : `Notebook "${notebookName}" deleted`
        );
      }
    }

    function toggleMenu(button) {
      const dropdown = button.querySelector('.menu-dropdown');
      document.querySelectorAll('.menu-dropdown').forEach(d => {
        if (d !== dropdown) d.classList.remove('show');
      });
      dropdown.classList.toggle('show');
    }

    document.addEventListener('click', function(e) {
      if (!e.target.closest('.notebook-menu')) {
        document.querySelectorAll('.menu-dropdown').forEach(d => {
          d.classList.remove('show');
        });
      }
      
      // Close clock settings when clicking outside
      if (!e.target.closest('#clock-widget')) {
        document.getElementById('clock-widget').classList.remove('active');
      }
      
      // Close color modal when clicking outside
      if (!e.target.closest('#colorModal') && e.target.id !== 'colorModal') {
        document.getElementById('colorModal').classList.remove('active');
      }
    });

    function changeFontSize(size) {
      document.getElementById('editor-area').style.fontSize = size + 'px';
      document.querySelector('.font-size-value').textContent = size + 'px';
    }

    function execCmd(command, value = null) {
      document.execCommand(command, false, value);
      document.getElementById('editor-area').focus();
    }

    function triggerImage() {
      document.getElementById('image-input').click();
    }

    // Add checkbox for tasks
    function addCheckbox() {
      const editor = document.getElementById('editor-area');
      const checkboxId = 'checkbox-' + Date.now();
      
      const checkboxHtml = `
        <div class="task-checkbox" contenteditable="false">
          <input type="checkbox" id="${checkboxId}" onchange="taskChecked(this)">
          <label for="${checkboxId}" contenteditable="true">Ø§Ø¶ØºØ· Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù‡Ù…Ø©</label>
        </div>
      `;
      
      document.execCommand('insertHTML', false, checkboxHtml);
      
      // Focus on the label after insertion
      setTimeout(() => {
        const label = document.getElementById(checkboxId).nextElementSibling;
        label.focus();
      }, 0);
    }

    // Play sound when task is checked
    function taskChecked(checkbox) {
      const sound = new Audio('data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU...'); // Short success sound
      sound.play();
      
      if (checkbox.checked) {
        checkbox.parentElement.style.opacity = '0.7';
      } else {
        checkbox.parentElement.style.opacity = '1';
      }
    }

    // Insert table
    function insertTable() {
      const rows = prompt(currentLang === 'ar' ? 'Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ:' : 'Number of rows:', '3');
      const cols = prompt(currentLang === 'ar' ? 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©:' : 'Number of columns:', '3');
      
      if (rows && cols && !isNaN(rows) && !isNaN(cols)) {
        let tableHtml = '<table border="1" style="width:100%;border-collapse:collapse;">';
        
        for (let i = 0; i < parseInt(rows); i++) {
          tableHtml += '<tr>';
          for (let j = 0; j < parseInt(cols); j++) {
            tableHtml += `<td style="padding:8px;border:1px solid var(--text-color);">${i === 0 ? 'Ø¹Ù†ÙˆØ§Ù†' : 'Ù…Ø­ØªÙˆÙ‰'}</td>`;
          }
          tableHtml += '</tr>';
        }
        
        tableHtml += '</table>';
        document.execCommand('insertHTML', false, tableHtml);
      } else {
        showToast(
          currentLang === 'ar' 
            ? 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø©' 
            : 'Please enter valid numbers',
          true
        );
      }
    }

    // Attach file
    function attachFile() {
      document.getElementById('file-input').click();
    }

    document.getElementById('file-input').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const fileLink = document.createElement('a');
          fileLink.href = e.target.result;
          fileLink.download = file.name;
          fileLink.textContent = file.name;
          fileLink.style.display = 'inline-block';
          fileLink.style.margin = '5px';
          fileLink.style.padding = '5px 10px';
          fileLink.style.backgroundColor = 'var(--primary-light)';
          fileLink.style.borderRadius = '4px';
          fileLink.style.color = 'var(--text-color)';
          fileLink.style.textDecoration = 'none';
          
          document.execCommand('insertHTML', false, fileLink.outerHTML);
        };
        reader.readAsDataURL(file);
      }
    });

    // Search functionality
    function showSearchModal() {
      document.getElementById('search-modal').style.display = 'block';
      document.getElementById('search-text').focus();
    }

    function hideSearchModal() {
      document.getElementById('search-modal').style.display = 'none';
      clearSearchHighlights();
      currentSearchIndex = -1;
      searchResults = [];
    }

    function searchText() {
      const searchTerm = document.getElementById('search-text').value.trim();
      if (!searchTerm) return;
      
      const editor = document.getElementById('editor-area');
      const content = editor.innerHTML;
      
      // Clear previous highlights
      clearSearchHighlights();
      
      // Find all matches
      const regex = new RegExp(searchTerm, 'gi');
      let match;
      searchResults = [];
      
      while ((match = regex.exec(content)) !== null) {
        searchResults.push({
          start: match.index,
          end: match.index + searchTerm.length
        });
      }
      
      if (searchResults.length === 0) {
        document.getElementById('search-results').innerHTML = 
          currentLang === 'ar' 
            ? '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>' 
            : '<p>No results found</p>';
        return;
      }
      
      // Highlight all matches
      highlightSearchResults();
      
      // Show results count
      document.getElementById('search-results').innerHTML = 
        currentLang === 'ar' 
          ? `<p>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${searchResults.length} Ù†ØªÙŠØ¬Ø©</p>` 
          : `<p>Found ${searchResults.length} results</p>`;
      
      // Navigate to first result
      currentSearchIndex = 0;
      navigateToSearchResult(currentSearchIndex);
    }

    function highlightSearchResults() {
      const editor = document.getElementById('editor-area');
      const searchTerm = document.getElementById('search-text').value.trim();
      const regex = new RegExp(searchTerm, 'gi');
      
      editor.innerHTML = editor.innerHTML.replace(regex, match => 
        `<span class="search-highlight">${match}</span>`
      );
    }

    function clearSearchHighlights() {
      const editor = document.getElementById('editor-area');
      const highlights = editor.querySelectorAll('.search-highlight');
      
      highlights.forEach(highlight => {
        const parent = highlight.parentNode;
        parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
        parent.normalize();
      });
    }

    function navigateSearch(direction) {
      if (searchResults.length === 0) return;
      
      currentSearchIndex += direction;
      
      if (currentSearchIndex >= searchResults.length) {
        currentSearchIndex = 0;
      } else if (currentSearchIndex < 0) {
        currentSearchIndex = searchResults.length - 1;
      }
      
      navigateToSearchResult(currentSearchIndex);
    }

    function navigateToSearchResult(index) {
      if (index < 0 || index >= searchResults.length) return;
      
      const highlights = document.querySelectorAll('.search-highlight');
      if (highlights.length === 0) return;
      
      // Remove previous active highlight
      highlights.forEach(highlight => {
        highlight.classList.remove('active-highlight');
      });
      
      // Add active class to current highlight
      highlights[index].classList.add('active-highlight');
      
      // Scroll to the highlight
      highlights[index].scrollIntoView({
        behavior: 'smooth',
        block: 'center'
      });
    }

    function saveContent() {
      if (currentNotebookId) {
        const content = document.getElementById('editor-area').innerHTML;
        const notebook = notebooks.find(n => n.id === currentNotebookId);
        if (notebook) {
          notebook.content = content;
          notebook.lastEdited = new Date().toLocaleString();
          saveNotebooks();
          renderNotebooks();
          
          showToast(
            currentLang === 'ar' 
              ? 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!' 
              : 'Content saved successfully!'
          );
        }
      }
    }

    document.getElementById('image-input').addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        if (file.size > 2 * 1024 * 1024) { // 2MB limit
          showToast(
            currentLang === 'ar' 
              ? 'Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 2MB)' 
              : 'Image too large (max 2MB)', 
            true
          );
          return;
        }
        
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => execCmd('insertImage', img.src);
        };
        reader.readAsDataURL(file);
      }
    });

    // Clock functions
    function setupClock() {
      if (clockInterval) clearInterval(clockInterval);
      clockInterval = setInterval(updateClock, 1000);
    }

    function updateClock() {
      let now;
      
      if (timezone === 'auto') {
        now = new Date();
      } else {
        const offset = parseInt(timezone.replace('UTC', '')) || 0;
        const utcNow = new Date();
        const localTime = utcNow.getTime() + (utcNow.getTimezoneOffset() * 60000);
        now = new Date(localTime + (offset * 3600000));
      }
      
      const timeStr = formatTime(now);
      const dateStr = formatDate(now);
      
      document.getElementById('clock-time').textContent = timeStr;
      document.getElementById('clock-date').textContent = dateStr;
    }

    function formatTime(date) {
      let hours = date.getHours();
      let minutes = date.getMinutes();
      let seconds = date.getSeconds();
      
      if (timeFormat === '12') {
        const ampm = hours >= 12 ? 'Ù…' : 'Øµ';
        hours = hours % 12;
        hours = hours ? hours : 12; // the hour '0' should be '12'
        return `${padZero(hours)}:${padZero(minutes)}:${padZero(seconds)} ${ampm}`;
      } else {
        return `${padZero(hours)}:${padZero(minutes)}:${padZero(seconds)}`;
      }
    }

    function formatDate(date) {
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      };
      return date.toLocaleDateString(currentLang === 'ar' ? 'ar-SA' : 'en-US', options);
    }

    function padZero(num) {
      return num < 10 ? `0${num}` : num;
    }

    // Save clock settings
    document.getElementById('timezone-select').addEventListener('change', function() {
      timezone = this.value;
      localStorage.setItem('timezone', timezone);
      updateClock();
    });

    document.getElementById('time-format').addEventListener('change', function() {
      timeFormat = this.value;
      localStorage.setItem('timeFormat', timeFormat);
      updateClock();
    });

    const translations = {
      ar: {
        logo: 'Ù…Ø°ÙƒØ±Ø©',
        home: 'Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©',
        editor: 'Ø§Ù„Ù…ÙÙƒØ±Ø©',
        mainTitle: 'Ù…ÙÙƒØ±Ø§ØªÙŠ',
        newNotebook: 'Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©',
        lastEdit: 'Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„: ',
        saveBtn: 'ğŸ’¾ Ø­ÙØ¸',
        saveSuccess: 'ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!',
        deleteConfirm: 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙÙƒØ±Ø©ØŸ',
        backBtn: 'â† Ø§Ù„Ø±Ø¬ÙˆØ¹',
        darkMode: 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†',
        lightMode: 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­',
        addNotebook: '+ Ø¥Ø¶Ø§ÙØ© Ù…Ø°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©',
        autoSave: 'ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§',
        notebooksCounter: 'Ø§Ù„Ù…Ø°ÙƒØ±Ø§Øª: ',
        pin: 'ØªØ«Ø¨ÙŠØª',
        unpin: 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ«Ø¨ÙŠØª',
        rename: 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…',
        delete: 'Ø­Ø°Ù',
        cancel: 'Ø¥Ù„ØºØ§Ø¡',
        search: 'Ø¨Ø­Ø«',
        searchPlaceholder: 'Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø«...',
        noResults: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬',
        resultsFound: 'ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ %d Ù†ØªÙŠØ¬Ø©',
        task: 'Ù…Ù‡Ù…Ø©',
        table: 'Ø¬Ø¯ÙˆÙ„',
        attach: 'Ù…Ù„Ù',
        rowsPrompt: 'Ø¹Ø¯Ø¯ Ø§Ù„ØµÙÙˆÙ:',
        colsPrompt: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©:',
        invalidNumbers: 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø©',
        timezone: 'Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:',
        timeFormat: 'ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª:',
        time12: '12 Ø³Ø§Ø¹Ø©',
        time24: '24 Ø³Ø§Ø¹Ø©',
        autoTimezone: 'ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØµÙØ­)',
        play: 'Ø§Ù„Ø¹Ø¨',
        gamesTitle: 'Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨',
        xoGame: 'Ù„Ø¹Ø¨Ø© XO',
        xoStatus: 'Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ %s',
        xoWin: 'ÙØ§Ø² Ø§Ù„Ù„Ø§Ø¹Ø¨ %s!',
        xoDraw: 'ØªØ¹Ø§Ø¯Ù„!',
        xoStart: 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©!',
        unoGame: 'Ù„Ø¹Ø¨Ø© UNO',
        unoStart: 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø©',
        unoRestart: 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„',
        unoMode: 'ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨Ø©',
        unoBot: 'Ø¶Ø¯ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨',
        unoHuman: 'Ø¶Ø¯ Ø´Ø®Øµ',
        unoDifficulty: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨',
        unoEasy: 'Ø³Ù‡Ù„',
        unoMedium: 'Ù…ØªÙˆØ³Ø·',
        unoHard: 'ØµØ¹Ø¨',
        unoYourTurn: 'Ø¯ÙˆØ±Ùƒ',
        unoBotTurn: 'Ø¯ÙˆØ± Ø§Ù„Ø­Ø§Ø³ÙˆØ¨',
        unoPlayerTurn: 'Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ %d',
        unoClockwise: 'ÙÙŠ Ø§ØªØ¬Ø§Ù‡ Ø¹Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©',
        unoCounterClockwise: 'Ø¹ÙƒØ³ Ø§ØªØ¬Ø§Ù‡ Ø¹Ù‚Ø§Ø±Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø©',
        unoCardsLeft: 'Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©',
        unoCurrentCard: 'Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©',
        unoDrawCard: 'Ø§Ø³Ø­Ø¨ ÙˆØ±Ù‚Ø©',
        unoChooseColor: 'Ø§Ø®ØªØ± Ù„ÙˆÙ†Ùƒ',
        unoWin: 'ğŸ‰ ÙØ²Øª! ğŸ‰',
        unoLose: 'ğŸ˜¢ Ø®Ø³Ø±Øª! ğŸ˜¢',
        unoPlayerWin: 'ğŸ‰ ÙØ§Ø² Ø§Ù„Ù„Ø§Ø¹Ø¨ %d! ğŸ‰'
      },
      en: {
        logo: 'Notebook',
        home: 'Home',
        editor: 'Notebook',
        mainTitle: 'My Notebooks',
        newNotebook: 'New Notebook',
        lastEdit: 'Last edited: ',
        saveBtn: 'ğŸ’¾ Save',
        saveSuccess: 'Content saved successfully!',
        deleteConfirm: 'Are you sure you want to delete this notebook?',
        backBtn: 'â† Back',
        darkMode: 'Dark Mode',
        lightMode: 'Light Mode',
        addNotebook: '+ Add New Notebook',
        autoSave: 'Auto-saved',
        notebooksCounter: 'Notebooks: ',
        pin: 'Pin',
        unpin: 'Unpin',
        rename: 'Rename',
        delete: 'Delete',
        cancel: 'Cancel',
        search: 'Search',
        searchPlaceholder: 'Type to search...',
        noResults: 'No results found',
        resultsFound: 'Found %d results',
        task: 'Task',
        table: 'Table',
        attach: 'File',
        rowsPrompt: 'Number of rows:',
        colsPrompt: 'Number of columns:',
        invalidNumbers: 'Please enter valid numbers',
        timezone: 'Timezone:',
        timeFormat: 'Time format:',
        time12: '12-hour',
        time24: '24-hour',
        autoTimezone: 'Auto (browser)',
        play: 'Play',
        gamesTitle: 'Games',
        xoGame: 'XO Game',
        xoStatus: 'Player %s turn',
        xoWin: 'Player %s wins!',
        xoDraw: 'Draw!',
        xoStart: 'Start the game!',
        unoGame: 'UNO Game',
        unoStart: 'Start Game',
        unoRestart: 'Restart',
        unoMode: 'Game Mode',
        unoBot: 'vs Computer',
        unoHuman: 'vs Human',
        unoDifficulty: 'Bot Difficulty',
        unoEasy: 'Easy',
        unoMedium: 'Medium',
        unoHard: 'Hard',
        unoYourTurn: 'Your Turn',
        unoBotTurn: 'Computer Turn',
        unoPlayerTurn: 'Player %d Turn',
        unoClockwise: 'Clockwise',
        unoCounterClockwise: 'Counter-Clockwise',
        unoCardsLeft: 'Cards Left',
        unoCurrentCard: 'Current Card',
        unoDrawCard: 'Draw Card',
        unoChooseColor: 'Choose Your Color',
        unoWin: 'ğŸ‰ You Win! ğŸ‰',
        unoLose: 'ğŸ˜¢ You Lose! ğŸ˜¢',
        unoPlayerWin: 'ğŸ‰ Player %d Wins! ğŸ‰'
      }
    };

    function changeLang(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      
      // Update language buttons
      document.getElementById('ar-btn').classList.toggle('active', lang === 'ar');
      document.getElementById('en-btn').classList.toggle('active', lang === 'en');
      
      const t = translations[lang];
      document.querySelector('.logo span:last-child').innerText = t.logo;
      document.querySelector('.main-title').innerText = t.mainTitle;
      
      document.querySelectorAll('nav ul li a')[0].innerText = t.home;
      document.querySelectorAll('nav ul li a')[1].innerText = t.editor;
      document.querySelector('.play-btn').innerHTML = `<i class="fas fa-gamepad"></i> ${t.play}`;
      
      document.querySelector('.back-btn').innerHTML = `<span>â†</span> ${t.backBtn}`;
      document.querySelector('.add-notebook-btn').innerHTML = `<span>+</span> ${t.addNotebook}`;
      document.querySelector('.dark-mode-toggle').innerHTML = 
        `<span id="dark-mode-icon">${darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}</span> ${darkMode ? t.lightMode : t.darkMode}`;
      
      document.querySelector('#rename-modal .modal-title').innerText = t.rename;
      document.querySelector('#notebook-name-input').placeholder = t.newNotebook;
      document.querySelector('#rename-modal .modal-btn.confirm').innerText = t.saveBtn;
      document.querySelector('#rename-modal .modal-btn.cancel').innerText = t.cancel;
      
      document.querySelector('#add-notebook-modal .modal-title').innerText = t.addNotebook;
      document.querySelector('#new-notebook-name').placeholder = t.newNotebook;
      document.querySelector('#add-notebook-modal .modal-btn.confirm').innerText = t.addNotebook;
      document.querySelector('#add-notebook-modal .modal-btn.cancel').innerText = t.cancel;
      
      document.querySelector('#auto-save-indicator').innerText = t.autoSave;
      document.querySelector('footer p').innerText = `Â© ${new Date().getFullYear()} - ${lang === 'ar' ? 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©' : 'All Rights Reserved'}`;
      
      // Update toolbar buttons
      document.querySelector('.toolbar button[onclick="saveContent()"]').innerHTML = t.saveBtn;
      document.querySelector('.toolbar button[onclick="addCheckbox()"]').innerHTML = `âœ“ ${t.task}`;
      document.querySelector('.toolbar button[onclick="insertTable()"]').innerHTML = `ğŸ“Š ${t.table}`;
      document.querySelector('.toolbar button[onclick="attachFile()"]').innerHTML = `ğŸ“ ${t.attach}`;
      document.querySelector('.toolbar button[onclick="showSearchModal()"]').innerHTML = `ğŸ” ${t.search}`;
      
      // Update search modal
      document.querySelector('#search-modal h3').textContent = t.search;
      document.querySelector('#search-text').placeholder = t.searchPlaceholder;
      document.querySelector('#search-modal button[onclick="navigateSearch(-1)"]').textContent = t.backBtn;
      document.querySelector('#search-modal button[onclick="navigateSearch(1)"]').textContent = currentLang === 'ar' ? 'Ø§Ù„ØªØ§Ù„ÙŠ' : 'Next';
      
      // Update clock settings
      document.querySelector('#clock-settings label[for="timezone-select"]').textContent = t.timezone;
      document.querySelector('#clock-settings label[for="time-format"]').textContent = t.timeFormat;
      document.querySelector('#time-format option[value="12"]').textContent = t.time12;
      document.querySelector('#time-format option[value="24"]').textContent = t.time24;
      document.querySelector('#timezone-select option[value="auto"]').textContent = t.autoTimezone;
      
      // Update games page
      document.querySelector('.games-title').textContent = t.gamesTitle;
      document.querySelectorAll('.game-card')[0].querySelector('.game-name').textContent = t.xoGame;
      document.querySelectorAll('.game-card')[1].querySelector('.game-name').textContent = t.unoGame;
      document.querySelectorAll('.play-btn-game').forEach(btn => btn.textContent = t.play);
      
      // Update XO game
      if (document.getElementById('xo-game').style.display === 'block') {
        document.getElementById('xo-status').textContent = t.xoStatus.replace('%s', currentPlayer);
      }
      
      // Update UNO game
      if (document.getElementById('uno-game').style.display === 'block') {
        document.getElementById('uno-startGame').textContent = t.unoStart;
        document.getElementById('uno-restart').textContent = t.unoRestart;
        document.querySelector('#mode-options .mode-option:nth-child(1)').textContent = t.unoBot;
        document.querySelector('#mode-options .mode-option:nth-child(2)').textContent = t.unoHuman;
        document.querySelector('#uno-bot-difficulty label').textContent = t.unoDifficulty;
        document.querySelector('#uno-difficulty option[value="easy"]').textContent = t.unoEasy;
        document.querySelector('#uno-difficulty option[value="medium"]').textContent = t.unoMedium;
        document.querySelector('#uno-difficulty option[value="hard"]').textContent = t.unoHard;
        document.querySelector('#uno-discard h2').textContent = t.unoCurrentCard;
        document.querySelector('#draw-card').innerHTML = `${t.unoDrawCard} (<span id="deck-count"></span>)`;
        document.querySelector('#colorModal h2').textContent = t.unoChooseColor;
      }
      
      updateNotebooksCounter();
      updateClock();
      
      // Update notebook cards
      document.querySelectorAll('.notebook-card').forEach(card => {
        const notebookId = card.getAttribute('data-id');
        const notebook = notebooks.find(n => n.id === notebookId);
        if (notebook) {
          card.querySelector('p').textContent = `${t.lastEdit}${notebook.lastEdited}`;
          card.querySelector('.pin-btn').textContent = notebook.pinned ? t.unpin : t.pin;
          
          const dropdown = card.querySelector('.menu-dropdown');
          dropdown.innerHTML = `
            <button onclick="showRenameModal('${notebookId}')">${t.rename}</button>
            <button onclick="togglePinNotebook('${notebookId}')">${notebook.pinned ? t.unpin : t.pin}</button>
            <button onclick="deleteNotebook('${notebookId}')">${t.delete}</button>
          `;
        }
      });
    }

    // Close modals when clicking outside
    window.addEventListener('click', function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
        if (event.target.id === 'search-modal') {
          clearSearchHighlights();
          currentSearchIndex = -1;
          searchResults = [];
        }
      }
    });

    // Close modals with ESC key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        document.querySelectorAll('.modal').forEach(modal => {
          modal.style.display = 'none';
        });
        clearSearchHighlights();
        currentSearchIndex = -1;
        searchResults = [];
        document.getElementById('clock-widget').classList.remove('active');
        document.getElementById('colorModal').classList.remove('active');
      }
    });

    window.addEventListener('unload', () => {
      clearInterval(autoSaveInterval);
      clearInterval(clockInterval);
    });
  </script>
</body>
</html>
